# Direct Predict ????

## ?? ????

Direct Predict????????????????????????????????*????????**???????? Polygon API ????????????????BMA Ultra ??????????

---

## ?? ????

1. **????**??????????????
2. **??????**???? Polygon API ??????
3. **??????**????????7??????
4. **??????**??????????**???EMA??**
5. **Excel??**?????Excel????
6. **??????*??????????????

---

## ?? ????

### ????

1. **????**????`app.py` ??`launch_gui.py`
2. **????**?????????? **"Direct Predict (Snapshot)"** ??
3. **????**????????????

### ????

#### ??1????????
- ?????????????????????
- ?????????????????????????
  - ???`AAPL,MSFT,GOOGL,TSLA,NVDA`

#### ??2????????????
- **??????????????*
- **?????? T+10 ??*?horizon=10??
- ??????????????

#### ??3??????
????????????
1. ??????
2. ????
3. ????
4. ????

---

## ?? ??????

### ????

```
???? "Direct Predict (Snapshot)"
    ??
????????????????????
    ??
????????????????
    ??
??????horizon?T+10??
    ??
????BMA Ultra ??
    ??
??????????80????+ ??????
    ??
??Polygon API ??????
    ??
?????7??????
    ??
????????
    ?? ??????????
    ?? ???????? latest_snapshot_id.txt??
    ?? ????????
    ?? ??????
    ??
???????????
    ??
??????????EMA????
    ??
??Excel??
    ??
??????
    ??
??Top????
```

---

## ?? ??????

### 1. ??????

**??????*??
1. **???????**???????????????????
2. **????**????????????????????

**????**??
```python
# ????????
if hasattr(self, 'selected_pool_info') and self.selected_pool_info:
    tickers = self.selected_pool_info['tickers']
else:
    # ????????
    tickers = ????????????
```

---

### 2. ??????

**??????80??????**

?????????????
- **252??????*????????`near_52w_high`????52??????????
- **????**???????????????8????
- **??**??80??????+ ????

**????**??
```python
MIN_REQUIRED_LOOKBACK_DAYS = 280  # 252????+ 28????
total_lookback_days = 280 + prediction_days
start_date = today - total_lookback_days
end_date = today
```

**??**??
- ??????2026-01-21??????
- ??????025-04-17 ??2026-01-21??281??

---

### 3. ??????

**????*?Polygon.io API

**????**??
- ?? `Simple17FactorEngine.fetch_market_data()`
- ????????????????
- ??????????????

**????????*??
- ????Open??
- ????Close??
- ????High??
- ????Low??
- ????Volume??
- ?????Date??

---

### 4. ????

**????**?`Simple17FactorEngine`

**??????*??7??????
1. `momentum_60d` - 60????
2. `rsi_21` - 21?RSI
(3. bollinger_squeeze ???) - ??????
4. `obv_momentum_60d` - 60?OBV??
5. `atr_ratio` - ATR??
7. `hist_vol_20` - 20??????
8. `vol_ratio_20d` - 20??????
9. `near_52w_high` - ??52????
(11. ret_skew_20d ???) - 20??????
12. `trend_r2_60` - 60???R?
13. `5_days_reversal` - 5????
14. `` - ??????
15. `obv_momentum_60d` - OBV??
16. `ivol_20` - 20??????
17. `roa`, `ebit`, `downside_beta_252`, `` ??

**????**?`mode='predict'`??????????????

---

### 5. ??????

**??ID??**????????
1. **`latest_snapshot_id.txt`**??????????????
2. **????????*????????????????????

**????**??
```python
snapshot_id_to_use = None
try:
    # ????????
    latest_snapshot_file = Path("latest_snapshot_id.txt")
    if latest_snapshot_file.exists():
        snapshot_id_to_use = latest_snapshot_file.read_text().strip()
except Exception:
    # ????????None?????????????
    pass
```

**??????*??
- **BMA Ultra ??**?`UltraEnhancedQuantitativeModel`
- **??????*??
  - ElasticNet??????
  - XGBoost??????
  - CatBoost??????
  - LambdaRank??????
  - MetaRankerStacker??????????

---

### 6. ????

**????????*??

1. **??????**??
   ```python
   # ??????????????
   date_mask = all_feature_data.index.get_level_values('date') <= pred_date
   date_feature_data = all_feature_data[date_mask].copy()
   ```

2. **??????**??
   ```python
   results = model.predict_with_snapshot(
       feature_data=date_feature_data,
       snapshot_id=snapshot_id_to_use,
       universe_tickers=tickers,
       as_of_date=pred_date,
       prediction_days=1
   )
   ```

3. **??????**??
   ```python
   # ??????????EMA????
   predictions_raw = results.get('predictions_raw')
   if predictions_raw is None:
       predictions_raw = results.get('predictions')  # ??
   ```

**??????**??
- **MultiIndex DataFrame**?`(date, ticker)` ????
- **score??*?????????????

---

### 7. ????

#### ??????
```python
# ?????????
if len(all_predictions) == 1:
    combined_predictions = all_predictions[0]
else:
    combined_predictions = pd.concat(all_predictions, axis=0)
```

#### ??????
```python
# ???EMA??????????????
final_predictions = combined_predictions.copy()
final_predictions['score_raw'] = final_predictions['score']
```

**??**?Direct Predict **???EMA??**????????????????

---

### 8. Excel????

**????**??
- ?????????
- ??????
- ??????????
- ??????????

**????**??
```
results/direct_predict_YYYYMMDD_HHMMSS.xlsx
```

**????**??
- **Sheet1**????????
- **??*?date, ticker, score, score_raw
- **??**??score????

---

### 9. ??????

**????*?`data/monitoring.db`

**????*??
```sql
CREATE TABLE direct_predictions (
    ts INTEGER,           -- ????
    snapshot_id TEXT,     -- ?????ID
    ticker TEXT,          -- ????
    score REAL            -- ????
)
```

**????**??
- ?????Top????
- ????????

---

### 10. Top????

**????**??
- Top 20 ????????????
- ???`??. ????: ????`

**????**??
```
[DirectPredict] ?? Top 20 ??:
   1. NVDA    : 0.852341
   2. TSLA    : 0.789123
   3. AAPL    : 0.765432
   ...
```

---

## ?? ?????

### ??????

**????????*??
- ??????????
- ??????????????80+??
- ??????????

**??**??
- ??API????
- ????
- ????????

### ??????

**??????*??
- ????????????
- ??????????

**??**??
- ??????
- ??????
- ????????

### ????

**??????*??
1. `latest_snapshot_id.txt`??????
2. ??????????????

**??**??
- ????????
- ??????
- ????????

---

## ?? ????

### Excel??
- **??**?`results/direct_predict_YYYYMMDD_HHMMSS.xlsx`
- **??**??????????????

### ??????
- **??**?`data/monitoring.db`
- **??**?`direct_predictions`
- **??**?Top??????????

### ????
- **??**????????
- **??**??????????

---

## ?? ????

### 1. ????
- **???????*??Polygon API????
- **??API??**???Polygon API????
- **????**??????????????-2????

### 2. ????
- **??????**????????????
- **??????**????????????
- **??????**??????????

### 3. ??????
- **????**????????
- **????**??????????
- **????**????????Polygon API????

### 4. ??Horizon
- **??T+10??*????????`prediction_horizon_days=10`
- **????**??????????????T+10
- **????**????????????80????

---

## ?? ????

### ??1????????
**????**??
- Polygon API??????
- ??????
- ??????

**????**??
- ??API??
- ???????
- ??????

### ??2????????
**????**??
- ????????
- ??????
- ??ID??

**????**??
- ???`latest_snapshot_id.txt`
- ??????????
- ????????????

### ??3????????
**????**??
- ????????80??
- ??????
- ??????

**????**??
- ??????????
- ???????
- ????????

---

## ?? ????

### ??????
- **10????1????*??30-60??
- **100????1????*??2-5??
- **1000????1????*??10-20??

### ????
- **????**??????????
- **????**??????????
- **????**?????????
- **API??**?Polygon API????

---

## ????

Direct Predict ????*??????????**????

1. ??**????**????????????
2. ??**????*????????????
3. ??**????**???????????EMA??
4. ??**????**???Excel????????
5. ??**????**????GUI??

**????**??
- ?????????
- ??????????
- ?????????
- ??????

**?????**??
- ?????????
- ??EMA??????
- ???????

---

## ?? ????

- `scripts/FULL_DATASET_TRAINING_SETUP.md` - ??????????
- `scripts/DIRECT_PREDICT_NO_EMA_UPDATE.md` - EMA??????
- `docs/????????????.md` - ??????



