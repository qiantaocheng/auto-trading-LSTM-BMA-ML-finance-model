# target_new å’Œ Close_new è¯´æ˜æ–‡æ¡£

## å‘ç°

é€šè¿‡æ£€æŸ¥æ•°æ®æ–‡ä»¶ `polygon_factors_all_filtered_clean_final_v2_subset_1_5_tickers.parquet`ï¼Œå‘ç°ï¼š

### 1. Close_new vs Close

- **Close_new å’Œ Close å®Œå…¨ç›¸ç­‰**ï¼ˆç›¸å…³æ€§ = 1.0ï¼‰
- ç»Ÿè®¡å€¼å®Œå…¨ç›¸åŒï¼š
  - Mean: 238.88
  - Std: 9169.49
  - Min: 0.00
  - Max: 691875.00

**ç»“è®º**ï¼š`Close_new` æ˜¯ `Close` çš„**å‰¯æœ¬**ï¼Œæ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚

### 2. target_new vs target

- **target_new å’Œ target ä¸ç›¸ç­‰**ï¼ˆç›¸å…³æ€§ = 0.07ï¼‰
- **target_new åŒ…å«å¤§é‡å¼‚å¸¸å€¼**ï¼š
  - Mean: 0.606ï¼ˆtarget: 0.0047ï¼‰
  - Std: 172.18ï¼ˆtarget: 0.0996ï¼‰
  - Max: 49390.5ï¼ˆtarget: 2.0ï¼‰
  - æœ‰116ä¸ªæ ·æœ¬å­˜åœ¨éé›¶å·®å¼‚

**å¼‚å¸¸æ ·æœ¬ç¤ºä¾‹**ï¼š
```
ticker: BEAG
target: 2.0 (å¯èƒ½æ˜¯æˆªæ–­å€¼)
target_new: 49274.0 - 49390.5 (å¼‚å¸¸å¤§çš„å€¼)
Close: 0.0002 (æä½ä»·æ ¼)
```

**ç»“è®º**ï¼š`target_new` åŒ…å«**é”™è¯¯æ•°æ®**æˆ–**è®¡ç®—é”™è¯¯**ï¼Œä¸åº”è¯¥ä½œä¸ºç‰¹å¾ä½¿ç”¨ã€‚

---

## ä¸ºä»€ä¹ˆè¿™äº›åˆ—å­˜åœ¨ï¼Ÿ

è¿™äº›åˆ—ï¼ˆ`target_new`, `Close_new`, `momentum_60d_new`, `obv_momentum_60d_new`, `making_new_low_5d_new`ï¼‰å¯èƒ½æ˜¯ï¼š

1. **æ•°æ®é¢„å¤„ç†è¿‡ç¨‹ä¸­çš„ä¸­é—´äº§ç‰©**
2. **æŸä¸ªç‰ˆæœ¬çš„å› å­è®¡ç®—ç•™ä¸‹çš„å¤‡ä»½åˆ—**
3. **æ•°æ®åˆå¹¶æ—¶äº§ç”Ÿçš„é‡å¤åˆ—**

---

## ä¸ºä»€ä¹ˆä¸èƒ½ä½œä¸ºç‰¹å¾ï¼Ÿ

### target_new å’Œ Close_new

1. **æ•°æ®æ³„éœ²é£é™©**ï¼š
   - `target_new` åŒ…å«ç›®æ ‡å˜é‡ä¿¡æ¯ï¼ˆå³ä½¿æœ‰é”™è¯¯ï¼‰
   - `Close_new` æ˜¯ `Close` çš„å‰¯æœ¬ï¼Œå¯èƒ½åŒ…å«æœªæ¥ä¿¡æ¯
   
2. **æ•°æ®è´¨é‡é—®é¢˜**ï¼š
   - `target_new` åŒ…å«å¼‚å¸¸å€¼ï¼ˆæœ€å¤§å€¼49390.5ï¼‰
   - è¿™äº›åˆ—ä¸æ˜¯çœŸæ­£çš„ç‰¹å¾ï¼Œè€Œæ˜¯ç›®æ ‡å˜é‡æˆ–ä»·æ ¼æ•°æ®

3. **æ¨¡å‹è®­ç»ƒå½±å“**ï¼š
   - å¦‚æœæ¨¡å‹çœ‹åˆ° `target_new`ï¼Œä¼šç›´æ¥"ä½œå¼Š"é¢„æµ‹
   - è¿™ä¼šå¯¼è‡´å¼‚å¸¸é«˜çš„ICï¼ˆå¦‚XGBoost: 0.9387, LambdaRank: 0.8272ï¼‰

---

## ä¿®å¤

å·²åœ¨ `scripts/time_split_80_20_oos_eval.py` ä¸­ä¿®å¤ï¼š

```python
# ğŸ”¥ CRITICAL FIX: Exclude target_new and Close_new to prevent data leakage!
exclude_cols = {'target', 'Close', 'ret_fwd_5d', 'sector', 'target_new', 'Close_new'}
all_feature_cols = [col for col in test_data.columns if col not in exclude_cols]
```

---

## æ‰€æœ‰ç‰¹å¾åˆ—åˆ—è¡¨

æ ¹æ®æ•°æ®æ–‡ä»¶ï¼Œå½“å‰ä½¿ç”¨çš„ç‰¹å¾åˆ—ï¼ˆå…±24ä¸ªï¼‰ï¼š

### Alphaå› å­ï¼ˆ17ä¸ªï¼‰ï¼š
1. `momentum_10d` - 10æ—¥åŠ¨é‡
2. `liquid_momentum` - æµåŠ¨æ€§åŠ¨é‡
3. `obv_momentum_40d` - 40æ—¥OBVåŠ¨é‡
4. `ivol_30` - 30æ—¥éšå«æ³¢åŠ¨ç‡
5. `rsi_21` - 21æ—¥RSI
6. `trend_r2_60` - 60æ—¥è¶‹åŠ¿RÂ²
7. `near_52w_high` - è·ç¦»52å‘¨é«˜ç‚¹
8. `ret_skew_30d` - 30æ—¥æ”¶ç›Šååº¦
9. `blowoff_ratio_30d` - 30æ—¥çˆ†å‘è¡Œæƒ…æ¯”ç‡
10. `atr_ratio` - ATRæ¯”ç‡
11. `vol_ratio_30d` - 30æ—¥æˆäº¤é‡æ¯”ç‡
12. `price_ma60_deviation` - ä»·æ ¼åç¦»60æ—¥å‡çº¿
13. `5_days_reversal` - 5æ—¥åè½¬
14. `downside_beta_ewm_21` - 21æ—¥ä¸‹è¡ŒBetaï¼ˆEWMAï¼‰
15. `feat_vol_price_div_30d` - 30æ—¥é‡ä»·èƒŒç¦»å› å­

### å…¶ä»–å› å­ï¼ˆ7ä¸ªï¼‰ï¼š
16. `roa` - èµ„äº§å›æŠ¥ç‡
17. `ebit` - æ¯ç¨å‰åˆ©æ¶¦
18. `downside_beta_252` - 252æ—¥ä¸‹è¡ŒBeta
19. `momentum_60d` - 60æ—¥åŠ¨é‡ï¼ˆT+5å› å­é›†ï¼‰
20. `obv_momentum_60d` - 60æ—¥OBVåŠ¨é‡ï¼ˆT+5å› å­é›†ï¼‰
21. `making_new_low_5d` - 5æ—¥åˆ›æ–°ä½æŒ‡æ ‡

### å¯ç–‘åˆ—ï¼ˆå·²æ’é™¤ï¼‰ï¼š
- `momentum_60d_new` - å¯èƒ½æ˜¯å¤‡ä»½åˆ—
- `obv_momentum_60d_new` - å¯èƒ½æ˜¯å¤‡ä»½åˆ—
- `making_new_low_5d_new` - å¯èƒ½æ˜¯å¤‡ä»½åˆ—

---

## æ•°æ®æ¸…ç†å®Œæˆ âœ…

å·²ä»ä»¥ä¸‹æ–‡ä»¶ä¸­å®Œå…¨åˆ é™¤æ‰€æœ‰ä¸éœ€è¦çš„åˆ—ï¼š

### æ¸…ç†çš„æ–‡ä»¶ï¼š
1. `polygon_factors_all_filtered_clean_final_v2_subset_1_5_tickers.parquet`
   - åŸå§‹åˆ—æ•°: 28
   - æ¸…ç†ååˆ—æ•°: 21
   - åˆ é™¤åˆ—æ•°: 7

2. `polygon_factors_all_filtered_clean_final_v2.parquet`
   - åŸå§‹åˆ—æ•°: 28
   - æ¸…ç†ååˆ—æ•°: 21
   - åˆ é™¤åˆ—æ•°: 7

### å·²åˆ é™¤çš„åˆ—ï¼š
- âœ… `target_new` - ç›®æ ‡å˜é‡å‰¯æœ¬ï¼ˆåŒ…å«é”™è¯¯æ•°æ®ï¼‰
- âœ… `Close_new` - æ”¶ç›˜ä»·å‰¯æœ¬
- âœ… `roa` - èµ„äº§å›æŠ¥ç‡
- âœ… `ebit` - æ¯ç¨å‰åˆ©æ¶¦
- âœ… `momentum_60d_new` - å¤‡ä»½åˆ—
- âœ… `obv_momentum_60d_new` - å¤‡ä»½åˆ—
- âœ… `making_new_low_5d_new` - å¤‡ä»½åˆ—

### å¤‡ä»½æ–‡ä»¶ï¼š
å·²åˆ›å»ºå¤‡ä»½æ–‡ä»¶ï¼ˆ`.backup` åç¼€ï¼‰ï¼Œå¯åœ¨éœ€è¦æ—¶æ¢å¤ã€‚

---

## å»ºè®®

1. âœ… **æ•°æ®æ¸…ç†**ï¼šå·²å®Œæˆ - ä»parquetæ–‡ä»¶ä¸­åˆ é™¤æ‰€æœ‰ `_new` åç¼€çš„åˆ—ã€`roa`ã€`ebit`
2. âœ… **è®­ç»ƒä»£ç æ£€æŸ¥**ï¼šå·²åœ¨ `time_split_80_20_oos_eval.py` ä¸­æ’é™¤è¿™äº›åˆ—
3. **æ•°æ®éªŒè¯**ï¼šåœ¨æ•°æ®é¢„å¤„ç†é˜¶æ®µæ·»åŠ éªŒè¯ï¼Œé˜²æ­¢ç›®æ ‡å˜é‡è¢«å½“ä½œç‰¹å¾

---

**åˆ›å»ºæ—¶é—´**: 2026-01-23
**æ¸…ç†å®Œæˆæ—¶é—´**: 2026-01-23
**ä¸¥é‡ç¨‹åº¦**: ğŸ”´ **ä¸¥é‡** - æ•°æ®æ³„éœ²å¯¼è‡´ICå¼‚å¸¸é«˜ï¼ˆå·²ä¿®å¤ï¼‰
