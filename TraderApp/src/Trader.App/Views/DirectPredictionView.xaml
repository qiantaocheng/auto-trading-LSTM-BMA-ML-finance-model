<UserControl x:Class="Trader.App.Views.DirectPredictionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             d:DesignHeight="800" d:DesignWidth="1000">
    <ScrollViewer VerticalScrollBarVisibility="Auto">
    <Grid Margin="20" Background="{StaticResource BackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <StackPanel>
            <Border Style="{StaticResource CardBorderStyle}">
                <StackPanel>
                    <TextBlock Text="Direct Prediction" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,12" />
                    <DockPanel>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                            <StackPanel Margin="0,0,12,0">
                                <TextBlock Text="Snapshot ID" FontWeight="Bold" />
                                <TextBox Width="260" Text="{Binding SnapshotId, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                            <Button Content="Run Prediction" Command="{Binding RunPredictionCommand}" />
                            <ProgressBar Width="150"
                                         Height="18"
                                         Margin="12,0,0,0"
                                         IsIndeterminate="True"
                                         Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
                        </StackPanel>
                    </DockPanel>
                    <Grid Margin="0,16,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Last Run" FontWeight="Bold" />
                            <TextBlock Text="{Binding LastRun, StringFormat=G}" Foreground="{StaticResource MutedBrush}" />
                        </StackPanel>
                        <StackPanel Grid.Column="1">
                            <TextBlock Text="Excel Output" FontWeight="Bold" />
                            <TextBlock Text="{Binding ExcelPath}" TextTrimming="CharacterEllipsis" Foreground="{StaticResource MutedBrush}" />
                        </StackPanel>
                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Status" FontWeight="Bold" />
                            <TextBlock Text="{Binding StatusMessage}" TextTrimming="CharacterEllipsis" Foreground="{StaticResource MutedBrush}" />
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>
            <!-- Model Retrain -->
            <Border Style="{StaticResource CardBorderStyle}">
                <StackPanel>
                    <TextBlock Text="Model Retrain" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,12" />
                    <DockPanel>
                        <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                            <Button Content="Retrain Model" Command="{Binding RetrainCommand}" />
                            <ProgressBar Width="150"
                                         Height="18"
                                         Margin="12,0,0,0"
                                         IsIndeterminate="True"
                                         Visibility="{Binding IsRetrainBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            <TextBlock Text="{Binding RetrainCountdownText}"
                                       VerticalAlignment="Center" Margin="12,0,0,0"
                                       FontWeight="SemiBold" />
                        </StackPanel>
                    </DockPanel>
                    <TextBlock Text="{Binding RetrainStatus}" Margin="0,8,0,0"
                               TextWrapping="Wrap" Foreground="{StaticResource MutedBrush}" />
                </StackPanel>
            </Border>

            <Border Style="{StaticResource CardBorderStyle}">
                <StackPanel>
                    <TextBlock Text="Top 20 Ranking" FontWeight="SemiBold" FontSize="16" Margin="0,0,0,12" />
                    <DataGrid ItemsSource="{Binding TopTwenty}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              HeadersVisibility="Column"
                              MaxHeight="300"
                              Margin="0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Ticker" Binding="{Binding Ticker}" Width="120" />
                            <DataGridTextColumn Header="Score" Binding="{Binding Score, StringFormat=F4}" Width="150" />
                            <DataGridTextColumn Header="EMA (4d)" Binding="{Binding Ema4, StringFormat=F4}" Width="150" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>

            <!-- Earnings Surprise Scanner -->
            <Border Style="{StaticResource CardBorderStyle}">
                <StackPanel>
                    <TextBlock Text="Earnings Surprise Scanner" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,12" />
                    <StackPanel Orientation="Horizontal">
                        <Button Content="Scan Earnings" Command="{Binding ScanEarningsCommand}" />
                        <ProgressBar Width="150"
                                     Height="18"
                                     Margin="0,0,0,0"
                                     IsIndeterminate="True"
                                     Visibility="{Binding IsEarningsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    </StackPanel>
                    <TextBlock Text="{Binding EarningsStatus}"
                               Margin="0,8,0,0"
                               TextWrapping="Wrap"
                               Foreground="{StaticResource MutedBrush}" />
                    <DataGrid ItemsSource="{Binding EarningsResults}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              HeadersVisibility="Column"
                              MaxHeight="300"
                              Margin="0,12,0,0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Ticker" Binding="{Binding Ticker}" Width="80" />
                            <DataGridTextColumn Header="Gap %" Binding="{Binding GapPct, StringFormat=F2}" Width="80" />
                            <DataGridTextColumn Header="Published" Binding="{Binding Published}" Width="100" />
                            <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </StackPanel>
            </Border>
        </StackPanel>
    </Grid>
    </ScrollViewer>
</UserControl>
