# avg_top_return è¯¦ç»†æ•°æ®æ¥æºå’Œè®¡ç®—è¯´æ˜

## ğŸ“Š æ•°æ®æ¥æº

**è¯„ä¼°è¿è¡Œ**: `run_20260122_021853`  
**æ•°æ®æ–‡ä»¶**: `polygon_factors_all_filtered_clean_final_v2.parquet` (å…¨é‡æ•°æ®)  
**è¯„ä¼°æ–¹æ³•**: 80/20 æ—¶é—´åˆ†å‰² OOSè¯„ä¼°  
**æµ‹è¯•æœŸ**: 2025-01-02 è‡³ 2025-12-30  
**å†å¹³è¡¡é¢‘ç‡**: æ¯10ä¸ªäº¤æ˜“æ—¥  
**Top N**: 20

## ğŸ” avg_top_return çš„å«ä¹‰

`avg_top_return` è¡¨ç¤ºï¼š**æ¯æ—¥é¢„æµ‹è´¨é‡è¯„ä¼°ä¸­ï¼ŒTop20è‚¡ç¥¨çš„å¹³å‡æ”¶ç›Šç‡**

### è®¡ç®—æ–¹å¼

1. **æ¯æ—¥è®¡ç®—**: å¯¹äºæµ‹è¯•æœŸçš„æ¯ä¸€å¤©ï¼Œè®¡ç®—Top20è‚¡ç¥¨çš„å¹³å‡æ”¶ç›Šç‡
2. **å–å¹³å‡å€¼**: å°†æ‰€æœ‰æ—¥æœŸçš„Top20å¹³å‡æ”¶ç›Šç‡å†å–å¹³å‡å€¼

### è¯¦ç»†è®¡ç®—æµç¨‹

#### æ­¥éª¤1: æ¯æ—¥Top20æ”¶ç›Šç‡è®¡ç®—

å¯¹äºæµ‹è¯•æœŸçš„æ¯ä¸€å¤©ï¼ˆdateï¼‰ï¼š
1. æ ¹æ®æ¨¡å‹é¢„æµ‹åˆ†æ•°ï¼Œé€‰æ‹©Top20è‚¡ç¥¨
2. è®¡ç®—è¿™20åªè‚¡ç¥¨çš„å®é™…æ”¶ç›Šç‡ï¼ˆT+10æ”¶ç›Šç‡ï¼‰
3. è®¡ç®—è¿™20åªè‚¡ç¥¨çš„å¹³å‡æ”¶ç›Šç‡ï¼š`top_return_mean = mean(actual_returns_top20)`

#### æ­¥éª¤2: æ±‡æ€»æ‰€æœ‰æ—¥æœŸçš„å¹³å‡å€¼

å°†æ‰€æœ‰æ—¥æœŸçš„`top_return_mean`å–å¹³å‡å€¼ï¼š
```python
avg_top_return = mean(all_dates_top_return_mean)
```

## ğŸ“ˆ å®é™…æ•°æ®ç¤ºä¾‹

### LambdaRank æ¨¡å‹

**avg_top_return**: 0.373908393295629 (37.39%)

**æ¯æœŸTop20æ”¶ç›Šç‡** (ä» `lambdarank_top20_timeseries.csv`):

| æ—¥æœŸ | Top20æ”¶ç›Šç‡ (%) | ç´¯è®¡æ”¶ç›Šç‡ (%) |
|------|----------------|---------------|
| 2025-01-02 | 35.61 | 35.61 |
| 2025-01-17 | 44.31 | 95.69 |
| 2025-02-03 | 42.44 | 178.74 |
| 2025-02-18 | 27.92 | 256.57 |
| 2025-03-04 | 38.37 | 393.38 |
| ... | ... | ... |
| 2025-12-17 | 2.04 | 343,233.83 |

**è®¡ç®—è¿‡ç¨‹**:
- å…±æœ‰25ä¸ªå†å¹³è¡¡æ—¥æœŸï¼ˆn_test_rebalances = 25ï¼‰
- æ¯æœŸçš„Top20æ”¶ç›Šç‡ï¼ˆå·²è½¬æ¢ä¸ºç™¾åˆ†æ¯”ï¼‰ï¼š
  - 35.61%, 44.31%, 42.44%, 27.92%, 38.37%, ...
- `avg_top_return = mean([35.61, 44.31, 42.44, 27.92, 38.37, ...]) / 100`
- ç»“æœ: 0.3739 (37.39%)

### CatBoost æ¨¡å‹

**avg_top_return**: 0.35757816616888444 (35.76%)

**æ¯æœŸTop20æ”¶ç›Šç‡** (ä» `catboost_top20_timeseries.csv`):

| æ—¥æœŸ | Top20æ”¶ç›Šç‡ (%) | ç´¯è®¡æ”¶ç›Šç‡ (%) |
|------|----------------|---------------|
| 2025-01-02 | 33.47 | 33.47 |
| 2025-01-17 | 41.10 | 88.32 |
| 2025-02-03 | 35.84 | 155.82 |
| 2025-02-18 | 28.11 | 227.73 |
| ... | ... | ... |
| 2025-12-17 | 0.75 | 238,977.88 |

**è®¡ç®—è¿‡ç¨‹**:
- åŒæ ·æœ‰25ä¸ªå†å¹³è¡¡æ—¥æœŸ
- `avg_top_return = mean([33.47, 41.10, 35.84, 28.11, ...]) / 100`
- ç»“æœ: 0.3576 (35.76%)

## ğŸ“‹ æŠ¥å‘Šä¸­çš„å…¶ä»–ç›¸å…³æŒ‡æ ‡

### avg_top_1_10_return

**å«ä¹‰**: Top1-10è‚¡ç¥¨çš„å¹³å‡æ”¶ç›Šç‡

**LambdaRank**: 0.3997534419576933 (39.98%)  
**CatBoost**: 0.37241337363142224 (37.24%)

### avg_top_5_15_return

**å«ä¹‰**: Top5-15è‚¡ç¥¨çš„å¹³å‡æ”¶ç›Šç‡

**LambdaRank**: 0.3861913063005471 (38.62%)  
**CatBoost**: 0.36518590073108037 (36.52%)

### avg_top_11_20_return

**å«ä¹‰**: Top11-20è‚¡ç¥¨çš„å¹³å‡æ”¶ç›Šç‡

**LambdaRank**: 0.37321023867223685 (37.32%)  
**CatBoost**: 0.3574689269108504 (35.75%)

### median_top_return

**å«ä¹‰**: Top20è‚¡ç¥¨æ”¶ç›Šç‡çš„ä¸­ä½æ•°

**LambdaRank**: 0.3723472849970577 (37.23%)  
**CatBoost**: 0.34611295681063126 (34.61%)

## ğŸ”¢ æ•°æ®ç»Ÿè®¡

### é¢„æµ‹æ•°é‡

**N_Predictions**: 924,016

è¿™è¡¨ç¤ºåœ¨æ•´ä¸ªæµ‹è¯•æœŸå†…ï¼Œå…±æœ‰924,016ä¸ªé¢„æµ‹ï¼ˆæ—¥æœŸÃ—tickerç»„åˆï¼‰

### å†å¹³è¡¡æ¬¡æ•°

**n_test_rebalances**: 25

æµ‹è¯•æœŸå†…å…±æœ‰25æ¬¡å†å¹³è¡¡ï¼ˆæ¯10ä¸ªäº¤æ˜“æ—¥ä¸€æ¬¡ï¼‰

### æµ‹è¯•æœŸæ—¶é—´èŒƒå›´

- **å¼€å§‹**: 2025-01-02
- **ç»“æŸ**: 2025-12-30
- **æ€»å¤©æ•°**: çº¦250ä¸ªäº¤æ˜“æ—¥ï¼ˆä¸€å¹´ï¼‰
- **å†å¹³è¡¡é—´éš”**: 10ä¸ªäº¤æ˜“æ—¥

## ğŸ“Š å®Œæ•´æ•°æ®æ–‡ä»¶

### ä¸»è¦æŠ¥å‘Šæ–‡ä»¶

1. **report_df.csv**: åŒ…å«æ‰€æœ‰æ¨¡å‹çš„æ±‡æ€»æŒ‡æ ‡
2. **oos_metrics.csv**: OOSè¯„ä¼°æŒ‡æ ‡ï¼ˆJSONæ ¼å¼çš„ç®€åŒ–ç‰ˆï¼‰
3. **oos_metrics.json**: å®Œæ•´çš„OOSæŒ‡æ ‡ï¼ˆJSONæ ¼å¼ï¼‰

### å„æ¨¡å‹çš„æ—¶é—´åºåˆ—æ–‡ä»¶

1. **lambdarank_top20_timeseries.csv**: LambdaRank Top20æ¯æœŸæ”¶ç›Šç‡
2. **catboost_top20_timeseries.csv**: CatBoost Top20æ¯æœŸæ”¶ç›Šç‡
3. **xgboost_top30_nonoverlap_timeseries.csv**: XGBoost Top30éé‡å æ”¶ç›Šç‡
4. **elastic_net_top30_nonoverlap_timeseries.csv**: ElasticNet Top30éé‡å æ”¶ç›Šç‡
5. **ridge_stacking_top30_nonoverlap_timeseries.csv**: Ridge Stacking Top30éé‡å æ”¶ç›Šç‡

### å…¶ä»–è¾“å‡ºæ–‡ä»¶

- **bucket_returns.csv**: åˆ†æ¡¶æ”¶ç›Šç‡
- **bucket_summary.csv**: åˆ†æ¡¶æ±‡æ€»
- **top20_vs_qqq.png**: Top20 vs QQQå¯¹æ¯”å›¾
- **top20_vs_qqq_cumulative.png**: ç´¯è®¡æ”¶ç›Šå¯¹æ¯”å›¾

## ğŸ¯ å…³é”®ç†è§£

### avg_top_return vs ç´¯è®¡æ”¶ç›Šç‡

- **avg_top_return**: æ¯æœŸTop20å¹³å‡æ”¶ç›Šç‡çš„å¹³å‡å€¼ï¼ˆ**ä¸åŒ…å«å¤åˆ©æ•ˆåº”**ï¼‰
- **ç´¯è®¡æ”¶ç›Šç‡**: æ¯æœŸæ”¶ç›Šç‡æŒ‰æœŸå¤åˆ©è®¡ç®—ï¼ˆ**åŒ…å«å¤åˆ©æ•ˆåº”**ï¼‰

### ä¸ºä»€ä¹ˆavg_top_returnæ˜¯å°æ•°ï¼Ÿ

å› ä¸ºæŠ¥å‘Šä¸­çš„`avg_top_return`æ˜¯**å°æ•°å½¢å¼**ï¼ˆ0.3739 = 37.39%ï¼‰ï¼Œè€Œä¸æ˜¯ç™¾åˆ†æ¯”å½¢å¼ã€‚

### ä¸ºä»€ä¹ˆç´¯è®¡æ”¶ç›Šç‡è¿™ä¹ˆå¤§ï¼Ÿ

å› ä¸ºï¼š
1. æ¯æœŸæ”¶ç›Šç‡éƒ½å¾ˆé«˜ï¼ˆ30-45%ï¼‰
2. æŒ‰æœŸå¤åˆ©è®¡ç®—
3. 25æœŸå¤åˆ©åï¼Œç´¯è®¡æ”¶ç›Šç‡ä¼šéå¸¸å¤§

ä¾‹å¦‚ï¼š
- ç¬¬1æœŸ: 35.61%
- ç¬¬2æœŸ: (1 + 0.3561) Ã— (1 + 0.4431) - 1 = 95.69%
- ç¬¬25æœŸ: ç´¯è®¡è¾¾åˆ°343,233.83%

## ğŸ“ ä»£ç ä½ç½®

**è®¡ç®—å‡½æ•°**: `calculate_group_returns_standalone()`  
**æ–‡ä»¶**: `scripts/time_split_80_20_oos_eval.py`  
**å…³é”®ä»£ç ** (line ~666):
```python
'avg_top_return': float(ts_df['top_return_mean'].mean()),
```

**è®¡ç®—æµç¨‹**:
1. å¯¹æ¯ä¸ªæ—¥æœŸï¼Œè®¡ç®—Top20çš„å¹³å‡æ”¶ç›Šç‡ â†’ `top_return_mean`
2. å°†æ‰€æœ‰æ—¥æœŸçš„`top_return_mean`å–å¹³å‡å€¼ â†’ `avg_top_return`

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2026-01-22  
**æ•°æ®æ¥æº**: `results/t10_time_split_80_20_final/run_20260122_021853/`
