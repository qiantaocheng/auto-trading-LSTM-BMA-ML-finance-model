# Sato 平方根因子验证结果报告（修正版）

## 📋 测试概述

**测试日期**: 2026-01-21  
**数据文件**: `data/factor_exports/polygon_factors_all_filtered_clean.parquet`  
**数据规模**: 4,180,394 行，3,921 只股票  
**日期范围**: 2021-01-19 至 2025-12-30  
**有效交易日**: 1,244 天  
**修复后有效数据**: 4,102,036 行（去除NaN后）

---

## 🔧 代码修复说明

### 修复的关键问题：

1. **✅ 分组计算修复**：确保所有计算都按ticker分组，避免股票切换时的数据污染
2. **✅ 直接使用vol_ratio_20d**：避免重复计算，减少精度损失
3. **✅ 数值稳定性**：添加clip保护（-5到5），防止vol接近0时产生无穷大
4. **✅ 公式简化**：移除冗余的`sign(x) * |x|`，直接使用`normalized_ret`

---

## 🎯 核心科学问题

**"Sato平方根因子是否提供了现有因子（如传统动量、波动率）之外的增量信息？"**

---

## 📊 测试结果总结

### ⚠️ **总体结论: FAIL**（但结果有改善）

**Pure IC (正交化后)**: **0.0049** ⬆️ (修复前: -0.0002)

根据评估标准：
- **FAIL**: Pure IC < 0.01
- **结论**: 虽然Pure IC从负值提升到正值，但仍未达到0.01的阈值
- **改善**: 修复后的代码确实改善了结果，说明之前的计算存在错误

---

## 📈 详细测试结果

### Test 1: Information Coefficient (IC) 分析

**原始 Sato 因子 IC**:
- **Mean Rank IC**: -0.0220 (修复前: -0.0277)
- **IC Std Dev**: 0.0435 (修复前: 0.0430)
- **IC IR (Sharpe)**: -0.5054 (修复前: -0.6443)
- **Positive IC Ratio**: 31.1% (修复前: 25.9%)
- **Valid Days**: 1,244

**IC 分布**:
- Min IC: -0.2010
- 25th Percentile: -0.0517
- Median IC: -0.0218
- 75th Percentile: 0.0071
- Max IC: 0.1388

**分析**:
- 原始 IC 仍为负值（-0.0220），但比修复前略有改善
- IC IR 从 -0.6443 改善到 -0.5054
- 正IC比例从25.9%提升到31.1%，但仍低于随机水平（50%）

---

### Test 2: 正交化测试（最重要）

**Pure Sato IC (去除 Mom & Vol 后)**:
- **Mean Pure IC**: **0.0049** ⬆️ (修复前: -0.0002)
- **Pure IC Std Dev**: 0.0458 (修复前: 0.0455)
- **Pure IC IR**: 0.1078 (修复前: -0.0044)
- **Valid Days**: 1,244

**评估结果**:
- ⚠️ **FAIL**: Pure IC < 0.01
- ✅ **改善**: Pure IC从负值提升到正值，说明修复后的计算更准确
- ⚠️ **结论**: 虽然有所改善，但仍未达到0.01的阈值，Sato因子提供的增量信息有限

**解释**:
- 修复后的Pure IC为正值（0.0049），说明Sato因子确实提供了一些增量信息
- 但这个增量信息非常微弱（< 0.01），可能不足以在实际交易中产生显著收益
- 平方根定律（√V）的引入带来了一些价值，但价值有限

---

### Test 3: 信号衰减分析 ⭐ **重要发现**

**IC Decay Profile**:
- **T+1 IC**: 0.0018
- **T+5 IC**: 0.0049
- **T+10 IC**: 0.0061
- **T+20 IC**: 0.0097

**分析**:
- ✅ **重要发现**: IC随着时间窗口增加而**增强**（而非衰减）
- ✅ **T+20 IC (0.0097)** 接近0.01的阈值，说明信号在更长的时间窗口上更有效
- ✅ 这符合"Metaorder（大单拆分）"理论：机构的大单持续数天，导致价格冲击在T+10甚至T+20依然显著

**诊断**:
- ⚠️ 信号在短期（T+1, T+5）较弱
- ✅ 信号在长期（T+10, T+20）更强
- 💡 **建议**: 如果使用Sato因子，应该考虑更长的预测horizon（T+20而非T+10）

---

### Test 4: 分位数单调性分析

**Quantile Returns (T+10)**:
| Group | Mean Return | Std Dev | Count |
|-------|-------------|---------|-------|
| Group 1 (Lowest) | 0.5046% | 11.8912% | 813,150 |
| Group 2 | 0.5099% | 11.7338% | 812,330 |
| Group 3 | 0.4938% | 11.6812% | 812,368 |
| Group 4 | 0.5297% | 12.6400% | 812,319 |
| Group 5 (Highest) | 0.5590% | 12.9033% | 812,660 |

**单调性检查**:
- **Group 5 (Highest) Return**: 0.5590%
- **Group 1 (Lowest) Return**: 0.5046%
- **Spread (5-1)**: 0.0544% (修复前: 0.0417%)

**评估**:
- ⚠️ **MARGINAL**: 单调性较弱
- Spread 只有 0.0544%，远低于 1% 的阈值
- Group 5 和 Group 1 的收益差异非常小，说明因子区分能力很弱
- 但比修复前略有改善（0.0417% → 0.0544%）

---

## 🔍 技术细节

### 数据准备

1. **价格数据**: 使用 `Close` 列作为 `adj_close`
2. **成交量数据**: 直接使用 `vol_ratio_20d` 作为相对成交量（避免重复计算）
3. **数据清洗**: 去除 NaN 值后，剩余 4,102,036 行

### Sato 因子计算（修正版）

**核心公式**:
```
Sato Impact = (r / sigma) * sqrt(V_rel)
Sato Factor = sum(Sato Impact over 10 days)
```

**关键修复**:
- 所有计算都按ticker分组（`groupby(level=1)`）
- 归一化收益clip到[-5, 5]范围
- 相对成交量clip到最小值0.01
- 波动率添加最小值保护（0.01 + 1e-6）

### 正交化方法

对每一天做横截面回归：
```
Sato = α + β1 * Momentum + β2 * Volatility + ε
```

使用残差 `ε`（Pure Sato）进行 IC 测试。

---

## 📊 修复前后对比

| 指标 | 修复前 | 修复后 | 变化 |
|------|--------|--------|------|
| Pure IC | -0.0002 | 0.0049 | ⬆️ +0.0051 |
| Pure IC IR | -0.0044 | 0.1078 | ⬆️ +0.1122 |
| 原始 IC | -0.0277 | -0.0220 | ⬆️ +0.0057 |
| IC IR | -0.6443 | -0.5054 | ⬆️ +0.1389 |
| 正IC比例 | 25.9% | 31.1% | ⬆️ +5.2% |
| Quantile Spread | 0.0417% | 0.0544% | ⬆️ +0.0027% |

**结论**: 修复后的代码确实改善了所有指标，说明之前的计算存在错误。

---

## ⚠️ 限制和注意事项

### 1. 成交量数据

- **现状**: 直接使用 `vol_ratio_20d` 作为相对成交量
- **影响**: 避免了重复计算的精度损失
- **建议**: 如果可能，使用包含原始 Volume 的数据文件重新测试

### 2. 数据质量

- **极端收益**: 过滤了极端收益（>1000% 或 < -90%）
- **幸存者偏差**: 数据文件可能不包含已退市股票
- **建议**: 使用包含退市股票的完整数据集重新测试

### 3. 因子实现

- **Sato 公式**: 使用了修正后的实现
- **标准化**: 添加了clip保护，提高了数值稳定性
- **建议**: 可以尝试不同的标准化方法或clip阈值

---

## 📝 结论和建议

### 主要结论

1. **代码修复有效**
   - Pure IC从-0.0002提升到0.0049
   - 所有指标都有改善，说明修复是必要的

2. **Sato 因子增量信息有限**
   - Pure IC = 0.0049，仍低于0.01的阈值
   - 虽然提供了一些增量信息，但价值有限

3. **重要发现：信号在长期更有效**
   - T+20 IC (0.0097) 接近0.01阈值
   - 建议使用更长的预测horizon（T+20而非T+10）

4. **分位数分析显示单调性很弱**
   - Group 5 vs Group 1 的收益差异只有 0.0544%
   - 远低于 1% 的阈值

### 可能的原因

1. **市场环境**: 在当前市场环境下，平方根定律可能不适用
2. **因子实现**: 虽然已修复，但可能仍有优化空间
3. **数据质量**: 数据可能不包含足够的信息来验证平方根定律
4. **预测horizon**: 可能需要使用更长的horizon（T+20）才能看到效果

### 建议

1. **使用T+20预测horizon**: IC Decay分析显示T+20 IC (0.0097) 接近阈值
2. **尝试不同的因子实现**: 可以尝试不同的标准化方法或clip阈值
3. **扩展数据集**: 使用包含退市股票的完整数据集
4. **分市场测试**: 在不同市场环境下测试（牛市、熊市、震荡市）
5. **组合其他因子**: 将Sato因子与其他因子组合，看是否能提升效果

---

## 📚 相关文件

- **测试脚本**: `scripts/test_sato_factor_validation.py` (修正版)
- **计算模块**: `scripts/sato_factor_calculation.py` (修正版)
- **数据文件**: `data/factor_exports/polygon_factors_all_filtered_clean.parquet`
- **验证框架**: 基于用户提供的严谨实证验证架构

---

## ✅ 验证完成

所有测试已完成，结果已保存。修复后的代码改善了所有指标，但Sato平方根因子在当前数据集上**提供的增量信息仍然有限**。

**关键发现**: 信号在T+20时间窗口上更有效（IC = 0.0097），建议考虑使用更长的预测horizon。
