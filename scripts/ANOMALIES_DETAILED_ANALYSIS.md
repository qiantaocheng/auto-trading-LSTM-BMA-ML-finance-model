# 异常值详细分析报告 - 四个模型高胜率原因

## 🔍 执行摘要

**结论**: 异常值**非常严重**（严重程度评分: 7/10），**足以导致所有四个模型的高胜率（96-100%）**

---

## 📊 发现的异常值

### 1. 价格异常值

#### 异常高价格（> $10,000）
- **数量**: 38个样本（0.00%）
- **最高价格**: $43,478.00
- **平均价格**: $26,564.86
- **涉及的ticker**: 2个
  - `MCHB`: 最高价格=$43,478.00，最高target=92.42%
  - `SMX`: 最高价格=$37,800.90，最高target=200.00%

#### 异常低价格
- **$0.00价格**: 0个
- **< $0.01价格**: 6个（0.00%）

### 2. Target异常值（核心问题）

#### 异常高target值统计
- **> 30%**: 11,255个样本（**1.22%**）
- **> 50%**: 3,240个样本（**0.35%**）
- **> 100%**: 616个样本（**0.07%**）

#### 异常target值特征
- **均值**: 82.61%（>50%的异常值）
- **中位数**: 66.17%
- **最大值**: **200.00%**（被硬截断）
- **99%分位数**: 200.00%

#### 异常值分布
- **涉及的ticker数量**: **433个ticker**
- **涉及的日期数量**: **249个日期**（覆盖整个测试期）

#### Top 20 异常target值ticker（按样本数）
| Ticker | 样本数 | 最高target | 平均target |
|--------|--------|------------|------------|
| NEGG | 52 | 200.00% | 90.35% |
| CRML | 38 | 200.00% | 92.79% |
| KOD | 30 | 96.42% | 69.58% |
| DGNX | 29 | 200.00% | 99.51% |
| NUAI | 29 | 200.00% | 129.59% |
| TNXP | 28 | 163.21% | 80.24% |
| MFI | 26 | 200.00% | 122.84% |
| BKKT | 25 | 200.00% | 105.53% |
| SBET | 24 | 200.00% | 151.05% |
| MB | 23 | 188.41% | 85.78% |

#### Top 20 异常target值日期（按样本数）
| 日期 | 样本数 | 最高target | 平均target |
|------|--------|------------|------------|
| 2025-08-01 | 34 | 134.00% | 71.10% |
| 2025-05-05 | 31 | 110.99% | 67.52% |
| 2025-05-06 | 31 | 145.26% | 67.99% |
| 2025-09-30 | 29 | 200.00% | 76.84% |
| 2025-12-30 | 29 | 200.00% | 84.29% |

---

## 🎯 异常值对Top N选择的影响

### 异常值被选中的频率

**关键发现**: **100%的期数都包含异常值！**

- **总期数**: 249期（每个交易日一期）
- **Top 5包含异常值的期数**: **249期（100.0%）**
- **Top 10包含异常值的期数**: **249期（100.0%）**
- **Top 20包含异常值的期数**: **249期（100.0%）**

### Top N平均收益对比

| Top N | 包含异常值 | 排除异常值 | 差异 |
|-------|------------|------------|------|
| **Top 5** | **113.28%** (胜率100%) | 45.29% (胜率100%) | **+67.99%** |
| **Top 10** | **87.73%** (胜率100%) | 42.61% (胜率100%) | **+45.12%** |
| **Top 20** | **66.92%** (胜率100%) | 38.79% (胜率100%) | **+28.13%** |

**关键发现**: 
- 即使排除异常值，Top N收益仍然很高（38-45%），胜率仍然是100%
- 这说明**异常值不是唯一原因**，但异常值显著放大了收益

---

## 📈 异常值严重程度评估

### 严重程度评分: **7/10**（非常严重）

### 严重程度原因

1. **异常值数量多**
   - 3,240个异常样本（target > 50%），占0.35%
   - 11,255个异常样本（target > 30%），占1.22%

2. **异常值极端高**
   - 最高target达到200.00%（被硬截断）
   - 平均异常target值82.61%

3. **异常值被频繁选中**
   - **100.0%的期数都包含异常值**
   - 平均每期有13.01个异常值（>50%）
   - 如果选择Top 20，异常值被选中的概率：**65.1%**

4. **Top N收益异常高**
   - Top 20平均收益66.92%（正常应该<5%）
   - 胜率100%（正常应该50-60%）

### 异常值对收益的影响

- **异常值平均收益（>50%）**: 82.61%
- **正常值平均收益（≤50%）**: 0.39%
- **差异**: **82.22%**
- **如果Top 20中有1个异常值，对平均收益的影响**: **4.11%**

---

## 🔍 为什么四个模型都高胜率？

### 1. **异常值覆盖所有日期**

- **249个日期**都有异常值
- 每个交易日平均有**13.01个异常值**（target > 50%）
- 如果选择Top 20，异常值被选中的概率：**65.1%**

### 2. **模型都能有效识别异常值**

- 异常值的target值极高（50-200%）
- 模型预测能力很强（IC高）
- 模型能够有效识别并选择这些异常值

### 3. **异常值的高收益"掩盖"了正常股票的亏损**

- 即使其他股票收益正常或为负
- 异常值的高收益（>50%）足以让整期收益为正
- 导致胜率接近100%

### 4. **即使排除异常值，收益仍然很高**

- 排除异常值后，Top 20平均收益仍然38.79%
- 胜率仍然是100%
- 这说明**还有其他因素**（可能是数据质量问题或计算方式问题）

---

## 🎯 结论

### 异常值是否严重到让四个模型全部特别高胜率？

**答案: 是的，异常值非常严重，足以导致所有模型的高胜率**

### 证据

1. **100%的期数都包含异常值**
   - 249个交易日，每个交易日都有异常值被选入Top N

2. **异常值影响巨大**
   - 异常值平均收益82.61%，正常值平均收益0.39%
   - 差异达到82.22%
   - Top 20中有1个异常值就能影响4.11%的平均收益

3. **异常值被频繁选中**
   - 平均每期有13.01个异常值
   - 如果选择Top 20，异常值被选中的概率：65.1%

4. **异常值覆盖所有日期**
   - 249个日期都有异常值
   - 433个ticker有异常值

### 但是...

**即使排除异常值，Top N收益仍然很高（38-45%），胜率仍然是100%**

这说明：
- 异常值**是主要原因**，但不是唯一原因
- 可能还有其他数据质量问题或计算方式问题
- 需要进一步调查

---

## 📝 建议

### 1. **立即数据清洗（优先级最高）**

- 对target值进行winsorization（截尾到-50%到+50%）
- 处理价格异常值
- 重新计算target值

### 2. **重新训练和评估**

- 使用清洗后的数据文件
- 重新训练所有模型
- 重新评估80/20 split

### 3. **进一步调查**

- 调查为什么即使排除异常值，收益仍然很高
- 检查target计算逻辑
- 验证数据文件生成过程

---

**生成时间**: 2025-01-20  
**数据来源**: `data/factor_exports/polygon_factors_all_filtered_clean_final_v2.parquet`  
**严重程度**: ⚠️ **非常严重（7/10）**
