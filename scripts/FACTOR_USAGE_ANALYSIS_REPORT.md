# å› å­ä½¿ç”¨æƒ…å†µå®Œæ•´åˆ†ææŠ¥å‘Š

## ğŸ“Š å› å­å®šä¹‰æ¦‚è§ˆ

### 1. T10_ALPHA_FACTORS (æ‰€æœ‰è®¡ç®—çš„å› å­)
**ä½ç½®**: `bma_models/simple_25_factor_engine.py`

**å› å­æ•°é‡**: 15 ä¸ª

**å› å­åˆ—è¡¨**:
1. `momentum_10d` - 10å¤©çŸ­æœŸåŠ¨é‡
2. `liquid_momentum` - æµåŠ¨æ€§åŠ¨é‡
3. `obv_momentum_40d` - OBVåŠ¨é‡ï¼ˆ40å¤©ï¼‰
4. `ivol_30` - ç‰¹è´¨æ³¢åŠ¨ç‡ï¼ˆ30å¤©ï¼‰
5. `rsi_21` - RSIæŒ‡æ ‡ï¼ˆ21å¤©ï¼‰
6. `trend_r2_60` - è¶‹åŠ¿RÂ²ï¼ˆ60å¤©ï¼‰
7. `near_52w_high` - æ¥è¿‘52å‘¨é«˜ç‚¹
8. `ret_skew_30d` - æ”¶ç›Šååº¦ï¼ˆ30å¤©ï¼‰
9. `blowoff_ratio_30d` - çˆ†é‡æ¯”ç‡ï¼ˆ30å¤©ï¼‰
10. `atr_ratio` - ATRæ¯”ç‡
11. `vol_ratio_30d` - æˆäº¤é‡æ¯”ç‡ï¼ˆ30å¤©ï¼‰
12. `price_ma60_deviation` - ä»·æ ¼MA60åç¦»åº¦
13. `5_days_reversal` - 5å¤©åè½¬ âš ï¸ **è®¡ç®—ä½†æœªä½¿ç”¨**
14. `downside_beta_ewm_21` - ä¸‹è¡ŒBetaï¼ˆEWM 21å¤©ï¼‰âš ï¸ **è®¡ç®—ä½†æœªä½¿ç”¨**
15. `feat_vol_price_div_30d` - é‡ä»·èƒŒç¦»å› å­ï¼ˆ30å¤©ï¼‰

---

### 2. t10_selected (å®é™…ç”¨äºç¬¬ä¸€å±‚æ¨¡å‹çš„å› å­)
**ä½ç½®**: `bma_models/é‡åŒ–æ¨¡å‹_bma_ultra_enhanced.py` (line 3283)

**å› å­æ•°é‡**: 13 ä¸ª

**å› å­åˆ—è¡¨**:
1. `momentum_10d`
2. `ivol_30`
3. `near_52w_high`
4. `rsi_21`
5. `vol_ratio_30d`
6. `trend_r2_60`
7. `liquid_momentum`
8. `obv_momentum_40d`
9. `atr_ratio`
10. `ret_skew_30d`
11. `price_ma60_deviation`
12. `blowoff_ratio_30d`
13. `feat_vol_price_div_30d`

**æœªåŒ…å«çš„å› å­**:
- `5_days_reversal` - åœ¨ T10_ALPHA_FACTORS ä¸­è®¡ç®—ï¼Œä½†ä¸åœ¨ t10_selected ä¸­
- `downside_beta_ewm_21` - åœ¨ T10_ALPHA_FACTORS ä¸­è®¡ç®—ï¼Œä½†ä¸åœ¨ t10_selected ä¸­

---

## âœ… è®­ç»ƒæµç¨‹ä¸­çš„å› å­ä½¿ç”¨

### å››ä¸ªç¬¬ä¸€å±‚æ¨¡å‹
æ‰€æœ‰å››ä¸ªç¬¬ä¸€å±‚æ¨¡å‹ï¼ˆElasticNet, CatBoost, XGBoost, LambdaRankï¼‰éƒ½ä½¿ç”¨ **ç›¸åŒçš„** `t10_selected` åˆ—è¡¨ï¼ˆ13ä¸ªå› å­ï¼‰ã€‚

**é…ç½®ä½ç½®**: `bma_models/é‡åŒ–æ¨¡å‹_bma_ultra_enhanced.py` (line 3301-3306)

```python
base_overrides = {
    'elastic_net': list(t10_selected),
    'catboost': list(t10_selected),
    'xgboost': list(t10_selected),
    'lambdarank': list(t10_selected),
}
```

**ç‰¹å¾é€‰æ‹©æ–¹æ³•**: `_get_first_layer_feature_cols_for_model()`
- ç¡®ä¿æ‰€æœ‰æ¨¡å‹ä½¿ç”¨ç›¸åŒçš„ç‰¹å¾åˆ—è¡¨
- è‡ªåŠ¨å¤„ç†ç‰¹å¾å¯¹é½å’Œç¼ºå¤±å€¼

---

## âœ… é¢„æµ‹æµç¨‹ä¸­çš„å› å­ä½¿ç”¨

### 1. Direct Predict (`app.py`)
**ä½ç½®**: `bma_models/é‡åŒ–æ¨¡å‹_bma_ultra_enhanced.py` (line 5356)

**base_features å®šä¹‰**:
```python
base_features = [
    'momentum_10d',
    'ivol_30', 'near_52w_high', 'rsi_21', 'vol_ratio_30d',
    'trend_r2_60', 'liquid_momentum', 'obv_momentum_40d', 'atr_ratio',
    'ret_skew_30d', 'price_ma60_deviation', 'blowoff_ratio_30d',
    'feat_vol_price_div_30d',
]
```

**çŠ¶æ€**: âœ… **ä¸ t10_selected å®Œå…¨ä¸€è‡´**ï¼ˆ13ä¸ªå› å­ï¼‰

**éªŒè¯**: åˆ†æè„šæœ¬ç¡®è®¤ base_features åŒ…å«çš„ 13 ä¸ªå› å­ä¸ t10_selected å®Œå…¨ç›¸åŒ

---

### 2. 80/20 OOS è¯„ä¼° (`time_split_80_20_oos_eval.py`)
**ç‰¹å¾å¯¹é½**: ä½¿ç”¨ `align_test_features_with_model()` å‡½æ•°

**æœºåˆ¶**:
- ä»è®­ç»ƒå¥½çš„æ¨¡å‹ä¸­è·å–ç‰¹å¾åï¼ˆ`feature_names_in_`ï¼‰
- è‡ªåŠ¨å¯¹é½æµ‹è¯•æ•°æ®ç‰¹å¾ä¸è®­ç»ƒç‰¹å¾
- ç¼ºå¤±ç‰¹å¾å¡«å……ä¸º 0.0
- é¢å¤–ç‰¹å¾è¢«å¿½ç•¥

**çŠ¶æ€**: âœ… **è‡ªåŠ¨å¯¹é½ï¼Œç¡®ä¿ä¸è®­ç»ƒæ—¶ä¸€è‡´**

---

## ğŸ“‹ å› å­ä½¿ç”¨æƒ…å†µæ€»ç»“

### âœ… æ­£ç¡®ä½¿ç”¨çš„å› å­ï¼ˆ13ä¸ªï¼‰
æ‰€æœ‰ä»¥ä¸‹å› å­éƒ½è¢«æ­£ç¡®ç”¨äºè®­ç»ƒå’Œé¢„æµ‹ï¼š

1. `momentum_10d` âœ…
2. `ivol_30` âœ…
3. `near_52w_high` âœ…
4. `rsi_21` âœ…
5. `vol_ratio_30d` âœ…
6. `trend_r2_60` âœ…
7. `liquid_momentum` âœ…
8. `obv_momentum_40d` âœ…
9. `atr_ratio` âœ…
10. `ret_skew_30d` âœ…
11. `price_ma60_deviation` âœ…
12. `blowoff_ratio_30d` âœ…
13. `feat_vol_price_div_30d` âœ…

### âš ï¸ è®¡ç®—ä½†æœªä½¿ç”¨çš„å› å­ï¼ˆ2ä¸ªï¼‰
ä»¥ä¸‹å› å­åœ¨ T10_ALPHA_FACTORS ä¸­è¢«è®¡ç®—ï¼Œä½†ä¸åœ¨ t10_selected ä¸­ï¼š

1. `5_days_reversal` - 5å¤©åè½¬å› å­
   - **çŠ¶æ€**: è®¡ç®—ä½†æœªä½¿ç”¨
   - **åŸå› **: ä¸åœ¨ t10_selected åˆ—è¡¨ä¸­
   - **å»ºè®®**: å¦‚æœä¸éœ€è¦ï¼Œå¯ä»¥ä» T10_ALPHA_FACTORS ä¸­ç§»é™¤ï¼›å¦‚æœéœ€è¦ï¼Œåº”æ·»åŠ åˆ° t10_selected

2. `downside_beta_ewm_21` - ä¸‹è¡ŒBetaï¼ˆEWM 21å¤©ï¼‰
   - **çŠ¶æ€**: è®¡ç®—ä½†æœªä½¿ç”¨
   - **åŸå› **: ä¸åœ¨ t10_selected åˆ—è¡¨ä¸­
   - **å»ºè®®**: å¦‚æœä¸éœ€è¦ï¼Œå¯ä»¥ä» T10_ALPHA_FACTORS ä¸­ç§»é™¤ï¼›å¦‚æœéœ€è¦ï¼Œåº”æ·»åŠ åˆ° t10_selected

### âŒ å·²ç§»é™¤çš„å› å­ï¼ˆ2ä¸ªï¼‰
ä»¥ä¸‹å› å­å·²ä»æ‰€æœ‰å› å­åˆ—è¡¨ä¸­ç§»é™¤ï¼š

1. `hist_vol_40d` - 40å¤©å†å²æ³¢åŠ¨ç‡ âœ… **å·²ç§»é™¤**
2. `bollinger_squeeze` - å¸ƒæ—å¸¦æŒ¤å‹ âœ… **å·²ç§»é™¤**

---

## âœ… éªŒè¯ç»“æœ

### è®­ç»ƒæµç¨‹
- âœ… æ‰€æœ‰å››ä¸ªç¬¬ä¸€å±‚æ¨¡å‹ä½¿ç”¨ç›¸åŒçš„ 13 ä¸ªå› å­
- âœ… ç‰¹å¾åˆ—è¡¨ä¸ t10_selected å®Œå…¨ä¸€è‡´
- âœ… ç‰¹å¾é€‰æ‹©æ–¹æ³•æ­£ç¡®å®ç°

### é¢„æµ‹æµç¨‹
- âœ… Direct Predict ä½¿ç”¨ä¸è®­ç»ƒç›¸åŒçš„ 13 ä¸ªå› å­
- âœ… 80/20 OOS è¯„ä¼°è‡ªåŠ¨å¯¹é½ç‰¹å¾
- âœ… ç‰¹å¾å¯¹é½æœºåˆ¶æ­£ç¡®å®ç°

### æ•°æ®ä¸€è‡´æ€§
- âœ… æ‰€æœ‰å› å­éƒ½åœ¨æ•°æ®æ–‡ä»¶ä¸­æ­£ç¡®è®¡ç®—
- âœ… SPY æ•°æ®å·²ä¸‹è½½å¹¶ç”¨äº `ivol_30` è®¡ç®—
- âœ… `feat_vol_price_div_30d` å·²æ­£ç¡®è®¡ç®—ï¼ˆ97.84% éé›¶å€¼ï¼‰

---

## ğŸ“ å»ºè®®

### 1. å…³äºæœªä½¿ç”¨çš„å› å­
**é€‰é¡¹ A**: å¦‚æœä¸éœ€è¦ `5_days_reversal` å’Œ `downside_beta_ewm_21`ï¼š
- ä» `T10_ALPHA_FACTORS` ä¸­ç§»é™¤å®ƒä»¬
- å‡å°‘ä¸å¿…è¦çš„è®¡ç®—å¼€é”€

**é€‰é¡¹ B**: å¦‚æœéœ€è¦è¿™ä¸¤ä¸ªå› å­ï¼š
- å°†å®ƒä»¬æ·»åŠ åˆ° `t10_selected` åˆ—è¡¨ä¸­
- æ›´æ–°æ‰€æœ‰å››ä¸ªç¬¬ä¸€å±‚æ¨¡å‹çš„é…ç½®

### 2. å› å­ä¸€è‡´æ€§
- âœ… å½“å‰é…ç½®å·²ç»éå¸¸ä¸€è‡´
- âœ… è®­ç»ƒå’Œé¢„æµ‹ä½¿ç”¨ç›¸åŒçš„å› å­åˆ—è¡¨
- âœ… æ‰€æœ‰å…³é”®å› å­éƒ½è¢«æ­£ç¡®ä½¿ç”¨

---

## ğŸ¯ ç»“è®º

**æ‰€æœ‰å› å­éƒ½å·²æ­£ç¡®æ”¾å…¥è®­ç»ƒå’Œé¢„æµ‹æµç¨‹ï¼**

- âœ… 13 ä¸ªæ ¸å¿ƒå› å­å…¨éƒ¨ç”¨äºè®­ç»ƒå’Œé¢„æµ‹
- âœ… å››ä¸ªç¬¬ä¸€å±‚æ¨¡å‹ä½¿ç”¨ç›¸åŒçš„ç‰¹å¾åˆ—è¡¨
- âœ… Direct Predict å’Œ 80/20 OOS è¯„ä¼°éƒ½æ­£ç¡®å¯¹é½ç‰¹å¾
- âœ… æ•°æ®æ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…è¦çš„å› å­è®¡ç®—

**çŠ¶æ€**: âœ… **å®Œæˆå¹¶éªŒè¯**

---

**ç”Ÿæˆæ—¶é—´**: 2025-01-20  
**åˆ†æè„šæœ¬**: `scripts/analyze_all_factors_usage.py`
