# è®­ç»ƒæ–‡ä»¶ vs Direct Predict æ ¼å¼å’Œå› å­å¯¹æ¯”æŠ¥å‘Š

## ğŸ“Š è®­ç»ƒæ–‡ä»¶æ ¼å¼éªŒè¯

**æ–‡ä»¶**: `D:\trade\data\factor_exports\polygon_factors_all_filtered_clean_final_v2.parquet`

**æ ¼å¼**:
- âœ… **ç´¢å¼•ç±»å‹**: `pd.MultiIndex`
- âœ… **çº§åˆ«åç§°**: `['date', 'ticker']`
- âœ… **ç¬¬ä¸€çº§ (date)**: `datetime64[ns]`
- âœ… **ç¬¬äºŒçº§ (ticker)**: `object` (string)
- âœ… **æ— é‡å¤ç´¢å¼•**: 0 ä¸ªé‡å¤
- âœ… **å½¢çŠ¶**: (4,180,394, 28)
- âœ… **æ€»åˆ—æ•°**: 28

---

## ğŸ” Direct Predict æ ¼å¼è¦æ±‚

**æ ¼å¼è¦æ±‚**:
- âœ… **ç´¢å¼•ç±»å‹**: `pd.MultiIndex`
- âœ… **çº§åˆ«åç§°**: `['date', 'ticker']`
- âœ… **ç¬¬ä¸€çº§ (date)**: `datetime64[ns]` (normalized, no time component)
- âœ… **ç¬¬äºŒçº§ (ticker)**: `object/string`
- âœ… **æ— é‡å¤ç´¢å¼•**: 0 ä¸ªé‡å¤

**æ ¼å¼åŒ¹é…**: âœ… **å®Œå…¨åŒ¹é…**

---

## ğŸ“Š å› å­å¯¹æ¯”åˆ†æ

### Direct Predict ä½¿ç”¨çš„å› å­ (T10_ALPHA_FACTORS)

**å› å­æ•°**: 15

**å› å­åˆ—è¡¨**:
1. `5_days_reversal`
2. `atr_ratio`
3. `blowoff_ratio_30d`
4. `downside_beta_ewm_21`
5. `feat_vol_price_div_30d`
6. `ivol_30`
7. `liquid_momentum`
8. `momentum_10d`
9. `near_52w_high`
10. `obv_momentum_40d`
11. `price_ma60_deviation`
12. `ret_skew_30d`
13. `rsi_21`
14. `trend_r2_60`
15. `vol_ratio_30d`

### è®­ç»ƒæ–‡ä»¶ä¸­çš„å› å­åˆ—

**å› å­åˆ—æ•°**: 26 (æ’é™¤å¸‚åœºæ•°æ®å’Œå…ƒæ•°æ®)

**å› å­åˆ—è¡¨**:
1. `5_days_reversal` âœ…
2. `Close_new` (é¢å¤–)
3. `atr_ratio` âœ…
4. `blowoff_ratio_30d` âœ…
5. `downside_beta_252` (é¢å¤–)
6. `downside_beta_ewm_21` âœ…
7. `ebit` (é¢å¤–)
8. `feat_vol_price_div_30d` âœ…
9. `ivol_30` âœ…
10. `liquid_momentum` âœ…
11. `making_new_low_5d` (é¢å¤–)
12. `making_new_low_5d_new` (é¢å¤–)
13. `momentum_10d` âœ…
14. `momentum_60d` (é¢å¤–)
15. `momentum_60d_new` (é¢å¤–)
16. `near_52w_high` âœ…
17. `obv_momentum_40d` âœ…
18. `obv_momentum_60d` (é¢å¤–)
19. `obv_momentum_60d_new` (é¢å¤–)
20. `price_ma60_deviation` âœ…
21. `ret_skew_30d` âœ…
22. `roa` (é¢å¤–)
23. `rsi_21` âœ…
24. `target_new` (é¢å¤–)
25. `trend_r2_60` âœ…
26. `vol_ratio_30d` âœ…

---

## âœ… å¯¹æ¯”ç»“æœ

### æ ¼å¼å¯¹æ¯”

| é¡¹ç›® | è®­ç»ƒæ–‡ä»¶ | Direct Predict | åŒ¹é…çŠ¶æ€ |
|------|---------|----------------|---------|
| ç´¢å¼•ç±»å‹ | MultiIndex | MultiIndex | âœ… åŒ¹é… |
| çº§åˆ«åç§° | ['date', 'ticker'] | ['date', 'ticker'] | âœ… åŒ¹é… |
| æ—¥æœŸç±»å‹ | datetime64[ns] | datetime64[ns] (normalized) | âœ… åŒ¹é… |
| Tickerç±»å‹ | object | object/string | âœ… åŒ¹é… |
| é‡å¤ç´¢å¼• | 0 ä¸ª | 0 ä¸ª | âœ… åŒ¹é… |

**æ ¼å¼åŒ¹é…**: âœ… **å®Œå…¨åŒ¹é…**

### å› å­å¯¹æ¯”

| é¡¹ç›® | æ•°é‡ | çŠ¶æ€ |
|------|------|------|
| Direct Predictä½¿ç”¨çš„å› å­ | 15 | - |
| è®­ç»ƒæ–‡ä»¶ä¸­çš„å› å­ | 26 | - |
| **å…±åŒå› å­** | **15** | âœ… **å®Œå…¨åŒ¹é…** |
| Direct Predictæœ‰ä½†è®­ç»ƒæ–‡ä»¶æ²¡æœ‰ | 0 | âœ… æ— ç¼ºå¤± |
| è®­ç»ƒæ–‡ä»¶æœ‰ä½†Direct Predictæ²¡æœ‰ | 11 | â„¹ï¸ é¢å¤–å› å­ï¼ˆä¸å½±å“ï¼‰ |

**å› å­åŒ¹é…**: âœ… **å®Œå…¨åŒ¹é…** - Direct Predictçš„æ‰€æœ‰å› å­éƒ½åœ¨è®­ç»ƒæ–‡ä»¶ä¸­

---

## ğŸ“‹ è®­ç»ƒæ–‡ä»¶ä¸­çš„é¢å¤–å› å­ï¼ˆä¸å½±å“é¢„æµ‹ï¼‰

è®­ç»ƒæ–‡ä»¶åŒ…å«ä»¥ä¸‹é¢å¤–å› å­ï¼Œè¿™äº›å› å­ä¸åœ¨Direct Predictçš„T10_ALPHA_FACTORSåˆ—è¡¨ä¸­ï¼š

1. `Close_new` - å¯èƒ½æ˜¯Closeçš„å¤‡ç”¨åˆ—
2. `downside_beta_252` - 252å¤©çš„downside betaï¼ˆDirect Predictä½¿ç”¨21å¤©EWMAç‰ˆæœ¬ï¼‰
3. `ebit` - EBITå› å­ï¼ˆå·²ä»T10å› å­åˆ—è¡¨ä¸­ç§»é™¤ï¼‰
4. `making_new_low_5d` - Falling-knifeé£é™©å› å­ï¼ˆæ—§ç‰ˆæœ¬ï¼‰
5. `making_new_low_5d_new` - Falling-knifeé£é™©å› å­ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
6. `momentum_60d` - 60å¤©åŠ¨é‡ï¼ˆDirect Predictä½¿ç”¨10å¤©ç‰ˆæœ¬ï¼‰
7. `momentum_60d_new` - 60å¤©åŠ¨é‡ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
8. `obv_momentum_60d` - 60å¤©OBVåŠ¨é‡ï¼ˆDirect Predictä½¿ç”¨40å¤©ç‰ˆæœ¬ï¼‰
9. `obv_momentum_60d_new` - 60å¤©OBVåŠ¨é‡ï¼ˆæ–°ç‰ˆæœ¬ï¼‰
10. `roa` - ROAå› å­ï¼ˆå·²ä»T10å› å­åˆ—è¡¨ä¸­ç§»é™¤ï¼‰
11. `target_new` - å¯èƒ½æ˜¯targetçš„å¤‡ç”¨åˆ—

**è¯´æ˜**: è¿™äº›é¢å¤–å› å­ä¸å½±å“é¢„æµ‹ï¼Œå› ä¸ºï¼š
- Direct Predictåªä½¿ç”¨T10_ALPHA_FACTORSä¸­å®šä¹‰çš„15ä¸ªå› å­
- è¿™äº›é¢å¤–å› å­å¯èƒ½æ˜¯æ—§ç‰ˆæœ¬æˆ–å¤‡ç”¨çš„å› å­
- æ¨¡å‹è®­ç»ƒæ—¶å¯èƒ½ä½¿ç”¨äº†è¿™äº›å› å­ï¼Œä½†é¢„æµ‹æ—¶åªä½¿ç”¨T10å› å­é›†

---

## ğŸ¯ å…³é”®å‘ç°

### âœ… æ ¼å¼å®Œå…¨åŒ¹é…

1. **MultiIndexæ ¼å¼**: âœ… åŒ¹é…
2. **çº§åˆ«åç§°**: âœ… åŒ¹é… (`['date', 'ticker']`)
3. **æ—¥æœŸç±»å‹**: âœ… åŒ¹é… (`datetime64[ns]`)
4. **Tickerç±»å‹**: âœ… åŒ¹é… (`object`)
5. **æ— é‡å¤ç´¢å¼•**: âœ… åŒ¹é…

### âœ… å› å­å®Œå…¨åŒ¹é…

1. **Direct Predictçš„æ‰€æœ‰15ä¸ªå› å­éƒ½åœ¨è®­ç»ƒæ–‡ä»¶ä¸­**: âœ…
2. **æ— ç¼ºå¤±å› å­**: âœ…
3. **æ ¼å¼ä¸€è‡´**: âœ…

---

## ğŸ”§ å·²å®æ–½çš„æ ¼å¼æ ‡å‡†åŒ–

### ä¿®å¤1: åœ¨`compute_all_17_factors`è¿”å›å‰æ ‡å‡†åŒ–æ ¼å¼

**ä½ç½®**: `bma_models/simple_25_factor_engine.py` line ~816

- âœ… éªŒè¯MultiIndexæ ¼å¼
- âœ… éªŒè¯çº§åˆ«åç§°ä¸º`['date', 'ticker']`
- âœ… éªŒè¯æ—¥æœŸç±»å‹æ˜¯normalized datetime
- âœ… éªŒè¯tickerç±»å‹æ˜¯string

### ä¿®å¤2: åœ¨Direct Predictä¸­æ ‡å‡†åŒ–`all_feature_data`æ ¼å¼

**ä½ç½®**: `autotrader/app.py` line ~1784

- âœ… æ ‡å‡†åŒ–æ—¥æœŸçº§åˆ«ï¼ˆnormalizeï¼‰
- âœ… æ ‡å‡†åŒ–tickerçº§åˆ«ï¼ˆstring, stripï¼‰
- âœ… é‡æ–°åˆ›å»ºMultiIndexç¡®ä¿æ ¼å¼ä¸€è‡´
- âœ… ç§»é™¤é‡å¤ç´¢å¼•

### ä¿®å¤3: åœ¨`_prepare_standard_data_format`ä¸­æ ‡å‡†åŒ–æ ¼å¼

**ä½ç½®**: `bma_models/é‡åŒ–æ¨¡å‹_bma_ultra_enhanced.py` line ~6630

- âœ… æ ‡å‡†åŒ–æ—¥æœŸå’Œtickerç±»å‹
- âœ… ç¡®ä¿çº§åˆ«åç§°ä¸º`['date', 'ticker']`
- âœ… ç§»é™¤é‡å¤ç´¢å¼•
- âœ… æ’åº

---

## ğŸ¯ æ€»ç»“

### æ ¼å¼åŒ¹é…

âœ… **å®Œå…¨åŒ¹é…** - Direct Predictçš„æ•°æ®æ ¼å¼ä¸è®­ç»ƒæ–‡ä»¶æ ¼å¼å®Œå…¨ä¸€è‡´

### å› å­åŒ¹é…

âœ… **å®Œå…¨åŒ¹é…** - Direct Predictä½¿ç”¨çš„æ‰€æœ‰15ä¸ªå› å­éƒ½åœ¨è®­ç»ƒæ–‡ä»¶ä¸­

### æ•°æ®å®Œæ•´æ€§

âœ… **å®Œæ•´** - è®­ç»ƒæ–‡ä»¶åŒ…å«æ‰€æœ‰å¿…éœ€çš„å› å­å’Œå¸‚åœºæ•°æ®åˆ—

---

## ğŸ“ å»ºè®®

1. âœ… **æ ¼å¼å·²æ ‡å‡†åŒ–** - æ— éœ€é¢å¤–æ“ä½œ
2. âœ… **å› å­å·²åŒ¹é…** - æ— éœ€é¢å¤–æ“ä½œ
3. â„¹ï¸ **é¢å¤–å› å­ä¸å½±å“** - è®­ç»ƒæ–‡ä»¶ä¸­çš„é¢å¤–å› å­ä¸å½±å“é¢„æµ‹ï¼Œå¯ä»¥å¿½ç•¥

---

**çŠ¶æ€**: âœ… **æ ¼å¼å’Œå› å­å®Œå…¨åŒ¹é…**

**éªŒè¯æ—¶é—´**: 2025-01-20

**ä¸‹ä¸€æ­¥**: è¿è¡ŒDirect Predictï¼ŒéªŒè¯æ ¼å¼å’Œå› å­åŒ¹é…æ­£å¸¸å·¥ä½œ
