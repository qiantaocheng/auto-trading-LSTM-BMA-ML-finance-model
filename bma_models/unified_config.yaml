# BMA ULTRA ENHANCED UNIFIED CONFIGURATION
# Single source of truth for all system parameters - Production-grade configuration management
# Integrates: temporal safety, training parameters, data requirements, feature engineering, evaluation metrics
# Used by: UnifiedTrainingConfig class, all BMA model components, trading system, risk management

# ==========================================
# TEMPORAL CONFIGURATION - CRITICAL PARAMETERS FOR PREVENTING DATA LEAKAGE
# Comprehensive time-based controls for maintaining temporal safety in ML pipeline
# ==========================================
temporal:
  # === éšæœºç§å­é…ç½® ===
  random_state: 42                     # ç»Ÿä¸€éšæœºç§å­
  
  # === æ ¸å¿ƒé¢„æµ‹å‚æ•° ===
  prediction_horizon_days: 10          # ğŸ”¥ T+10é¢„æµ‹ï¼ˆåŒå‘¨ï¼‰
  holding_period_days: 10              # 10å¤©æŒæœ‰æœŸï¼ˆä¸T+10ä¸€è‡´ï¼‰

  # === æ—¶é—´éš”ç¦»å‚æ•° (ğŸ”¥ OPTIMIZED FOR T+10) ===
  feature_lag_days: 1                  # T-1ç‰¹å¾æ»åï¼ˆä»ç„¶é˜²æ­¢æ³„æ¼ï¼‰
  cv_gap_days: 10                      # Gap = 10å¤©ï¼ˆä¸T+10å¯¹é½ï¼‰
  cv_embargo_days: 10                  # Embargo = 10å¤©ï¼ˆä¸T+10å¯¹é½ï¼‰
  oos_embargo_days: 10                 # OOS embargo ä¸é¢„æµ‹horizonä¸€è‡´
  effective_isolation_days: 20         # gap+embargo = 20å¤©
  safety_gap_days: 1                   # å®‰å…¨é—´éš” 1å¤©
  min_total_gap_days: 10               # æœ€å°æ€»é—´éš” 10å¤©

  # === äº¤å‰éªŒè¯å‚æ•° (ğŸ”¥ OPTIMIZED FOR T+10) ===
  cv_n_splits: 6                       # ä»ç”¨6æŠ˜ï¼ˆå¦‚éœ€æ›´ç¨³å¯é™ä¸º5ï¼‰
  cv_test_ratio: 0.12                  # æµ‹è¯•é›†æ¯”ä¾‹ 12%
  min_train_test_gap_days: 10          # è®­ç»ƒæµ‹è¯•æœ€å°é—´éš” 10å¤©
  min_train_window_days: 252           # ğŸ”§ æœ€å°è®­ç»ƒçª—ï¼š1å¹´äº¤æ˜“æ—¥ï¼ˆ252å¤©ï¼‰ï¼Œç”¨äºCV purged split
  
  # === æ ·æœ¬æƒé‡å‚æ•° ===
  sample_weight_half_life_days: 75     # æ ·æœ¬æƒé‡åŠè¡°æœŸï¼ˆå¤©ï¼‰
  
  # === ç”Ÿäº§é—¸é—¨é˜ˆå€¼ ===
  min_rank_ic: 0.02                    # æœ€ä½RankICè¦æ±‚
  min_t_stat: 2.0                      # æœ€ä½tç»Ÿè®¡é‡
  min_coverage_months: 12              # æœ€ä½è¦†ç›–æœˆæ•°
  min_qlike_reduction_pct: 0.12        # QLIKEæœ€å°æ”¹å–„ï¼ˆ12%ï¼‰

# ==========================================
# VALIDATION THRESHOLDS - FINE-GRAINED PARAMETER CONTROL
# Quality gates and validation criteria for production deployment
# ==========================================
validation_thresholds:
  # å¤–éƒ¨targetæ ¡éªŒé˜ˆå€¼ï¼ˆè½¯ç¡¬é˜ˆå€¼åˆ†ç¦»ï¼‰
  target_validation:
    min_target_corr_soft: 0.005        # è½¯é˜ˆå€¼ï¼šä½äºæ­¤å€¼å‘Šè­¦
    min_target_corr_hard: 0.001        # ç¡¬é˜ˆå€¼ï¼šä½äºæ­¤å€¼ä¸­æ­¢
    min_overlap_samples_soft: 100      # æœ€å°é‡å æ ·æœ¬æ•°è½¯é˜ˆå€¼
    min_overlap_samples_hard: 50       # æœ€å°é‡å æ ·æœ¬æ•°ç¡¬é˜ˆå€¼

  # ICç›¸å…³é˜ˆå€¼
  ic_processing:
    ffill_limit: 5                     # IC ffillæœ€å¤§å¤©æ•°
    bfill_limit: 2                     # IC bfillæœ€å¤§å¤©æ•°
    min_valid_days_for_ic: 3           # ICè®¡ç®—æœ€å°æœ‰æ•ˆå¤©æ•°
    min_daily_stocks: 10               # æ¯æ—¥æœ€å°è‚¡ç¥¨æ•°ï¼ˆè·³è¿‡ICè®¡ç®—ï¼‰
    small_variance_threshold: 1e-8     # å°æ–¹å·®é˜ˆå€¼ï¼ˆç›´æ¥ç½®é›¶ï¼‰

  # æƒé‡æ›´æ–°ç¨³å¥æ€§
  weight_update:
    min_effective_days: 5              # æƒé‡æ›´æ–°æœ€å°æœ‰æ•ˆå¤©æ•°
    min_samples_per_day: 10            # æ¯æ—¥æœ€å°æ ·æœ¬æ•°
    ewma_min_valid_points: 3           # EWMAæœ€å°æœ‰æ•ˆç‚¹æ•°

  # Catastrophic gateé˜ˆå€¼
  catastrophic_gate:
    min_avg_ic: -0.02                  # å¹³å‡ICæœ€ä½é˜ˆå€¼
    max_negative_r2: -0.5              # æœ€å¤§è´ŸRÂ²é˜ˆå€¼
    trigger_count_threshold: 3         # è¿ç»­è§¦å‘æ¬¡æ•°é˜ˆå€¼

  # è´¨é‡æ ‡è®°é˜ˆå€¼
  quality_gates:
    min_prediction_variance: 1e-6      # æœ€å°é¢„æµ‹æ–¹å·®
    min_prediction_range: 1e-4         # æœ€å°é¢„æµ‹èŒƒå›´
    max_nan_ratio: 0.1                 # æœ€å¤§NaNæ¯”ä¾‹

# ==========================================
# STRICT MODE CONFIGURATION - PRODUCTION SAFETY CONTROLS
# Enhanced validation and error handling for institutional-grade deployment
# ==========================================
strict_mode:
  enable_strict_cv: false              # ä¸¥æ ¼CVæ¨¡å¼å¼€å…³ï¼ˆæ¯æŠ˜ç”¨è®­ç»ƒæ ·æœ¬ç»Ÿè®¡ï¼‰
  enable_determinism_strict: true      # ä¸¥æ ¼ç¡®å®šæ€§æ¨¡å¼
  enable_temporal_strict: true         # ä¸¥æ ¼æ—¶é—´éªŒè¯
  enable_feature_validation: true     # ä¸¥æ ¼ç‰¹å¾éªŒè¯
  use_kronos_validation: true         # Kronosé£é™©éªŒè¯å’ŒTop 35ç­›é€‰ï¼ˆå·²å¯ç”¨ï¼‰
  use_tradingagents: false            # TradingAgentså¤šæ™ºèƒ½ä½“æ·±åº¦åˆ†æï¼ˆéœ€è¦OpenAI APIï¼‰

# ==========================================
# DATA CONFIGURATION - SINGLE FORMAT ONLY (NO FALLBACKS)
# Enforces MultiIndex(date, ticker) format with strict validation requirements
# ==========================================
data:
  # MANDATORY DATA FORMAT
  required_format: "MultiIndex"           # ONLY MultiIndex(date, ticker) accepted
  required_index_names: ["date", "ticker"]  # STRICT index naming
  required_target_column: "target"       # Target column name
  min_features: 2                        # Minimum feature columns
  
  # æ•°æ®ä¸‹è½½é…ç½®
  max_risk_model_tickers: 50
  max_market_regime_tickers: 20
  max_alpha_data_tickers: 50
  
  # å†å²æ•°æ®å¤©æ•°
  risk_model_history_days: 300
  market_regime_history_days: 200
  alpha_data_history_days: 200
  
  # æ•°æ®è´¨é‡è¦æ±‚ - NO COMPROMISES
  min_data_days: 20
  min_risk_model_days: 100
  min_cross_sectional_stocks: 30    # æ¨ªæˆªé¢æœ€å°‘è‚¡ç¥¨æ•°
  min_oof_coverage: 0.5              # Minimum OOF coverage (50%)
  min_samples_per_model: 100         # Minimum samples for model training
  min_samples_for_cv: 400            # Match CONFIG.MIN_SAMPLES_FOR_CV
  
  # æ‰¹å¤„ç†é…ç½®
  batch_size: 50
  api_delay: 0.12
  max_retries: 3

# ==========================================
# FEATURE ENGINEERING CONFIGURATION - 25 HIGH-QUALITY FACTORS
# Professional-grade factor construction with cross-sectional standardization
# ==========================================
features:
  # æŠ€æœ¯æŒ‡æ ‡é…ç½®
  beta_calculation_window: 60
  rsi_period: 14                       # ğŸ”¥ RSI-14 (T+5 optimized, longer period)
  volatility_window: 20
  momentum_window: 20
  
  # ç‰¹å¾é€‰æ‹©
  feature_selection:
    method: "robust"
    max_features: 25                    # FIXED: Set to 25 as requested
    min_features: 5                     # Match CONFIG.MIN_FEATURES  
    min_importance: 1e-6                # Match CONFIG.VARIANCE_THRESHOLD
    correlation_threshold: 0.95         # Match CONFIG.CORRELATION_THRESHOLD
    
  # ç‰¹å¾æ»åä¼˜åŒ–
  lag_optimization:
    enable: true
    max_lag: 5
    optimization_method: "grid_search"
    
  # æ¨ªæˆªé¢å› å­æ ‡å‡†åŒ– (NEW)
  cross_sectional_standardization:
    enable: true                        # å¯ç”¨æ¨ªæˆªé¢æ ‡å‡†åŒ–
    min_valid_ratio: 0.5               # æœ€å°æœ‰æ•ˆæ ·æœ¬æ¯”ä¾‹
    outlier_method: "iqr"              # å¼‚å¸¸å€¼å¤„ç†æ–¹æ³•: ['iqr', 'zscore', 'quantile']
    outlier_threshold: 3.0             # å¼‚å¸¸å€¼é˜ˆå€¼
    fill_method: "cross_median"        # ç¼ºå¤±å€¼å¡«å……æ–¹æ³•: ['cross_median', 'zero', 'forward_fill']
    industry_neutral: false            # æ˜¯å¦è¿›è¡Œè¡Œä¸šä¸­æ€§åŒ–
    validation_samples: 30             # éªŒè¯æ ‡å‡†åŒ–æ•ˆæœçš„æœ€å°æ ·æœ¬æ•°

  # è‡ªé€‚åº”å› å­è¡°å‡
  factor_decay:
    enable: true
    base_halflife: 30
    family_specific_halflives:
      momentum: 8
      reversal: 5
      volatility: 6
      quality: 60
      value: 90
      sentiment: 10
      volume: 7
      technical: 12
      fundamental: 120
      microstructure: 3

# ==========================================
# æ¨¡å‹è®­ç»ƒé…ç½® - SINGLE CV SYSTEM ONLY
# ==========================================
training:
  # è®­ç»ƒç±»å‹
  incremental_days: 14
  full_rebuild_days: 28
  
  # äº¤å‰éªŒè¯ - OPTIMIZED FOR T+5
  cv_method: "time_series_split"          # ONLY TimeSeriesSplit accepted
  cv_splits: 6                            # ç»Ÿä¸€æ‰€æœ‰æ¨¡å‹ä½¿ç”¨6æŠ˜CVï¼ˆä¸temporalä¸€è‡´ï¼‰
  cv_gap_days: 5                         # Gap = 5å¤©ï¼ˆä¸temporalä¸€è‡´ï¼‰
  cv_embargo_days: 5                     # Embargo = 5å¤©
  cv_min_train_size: 252                 # Match CONFIG.MIN_TRAIN_SIZE (1 year)
  test_size: 63                          # ~3ä¸ªæœˆçª—å£
  cv_no_fallback: true                   # NO FALLBACK CV METHODS

  # æç«¯targetè¿‡æ»¤ (é˜²æ­¢WWç­‰9900%æ¶¨å¹…æˆ–-88%è·Œå¹…æ‰­æ›²æ¨¡å‹è®­ç»ƒ)
  extreme_target_filter:
    enabled: true                        # å¯ç”¨æç«¯å€¼è¿‡æ»¤
    method: "hard_clip"                  # ğŸ”§ ç¡¬æˆªæ–­æ–¹æ³•ï¼ˆä¸æ˜¯åˆ é™¤ï¼‰
    clip_lower: -0.55                    # ğŸ”§ ç¡¬æˆªæ–­ä¸‹ç•Œï¼ˆ10å¤©æ”¶ç›Š-55%ï¼Œå·²ç»å¾ˆå®½ï¼‰
    clip_upper: 0.55                     # ğŸ”§ ç¡¬æˆªæ–­ä¸Šç•Œï¼ˆ10å¤©æ”¶ç›Š+55%ï¼Œå·²ç»å¾ˆå®½ï¼‰
    # è¯´æ˜: å¯¹targetåšç¡¬æˆªæ–­ï¼ˆwinsorize/clipï¼‰ï¼Œä¸æ˜¯åˆ é™¤
    #       è®­ç»ƒä¸è¯„ä¼°åŒæ—¶ï¼šclip(y, -0.55, +0.55)
    #       è¿™ä¸€æ­¥ä¼šç«‹åˆ»è®©"mean vs median å·®å‡ ç™¾å€"æ¶ˆå¤±ï¼Œç»“æœå¯è§£é‡Š
    #       é‡åˆ°9000%è¿™ç§ï¼Œè¯´æ˜å•ä½æˆ–å¯¹é½é”™è¯¯ï¼Œä½†åœ¨å®šä½bugå‰ï¼Œè‡³å°‘è¦è®©è®­ç»ƒ/è¯„ä¼°ä¸è¢«ç‚¸ç©¿

  # åŸºç¡€MLæ¨¡å‹ - UPDATED 2025-01-19
  base_models:
    elastic_net:
      enable: true
      alpha: 0.0012         # ğŸ”§ 0.002 -> 0.0012ï¼ˆåˆ«å¤ªç¡¬ï¼Œä¿æŒä¸€ç‚¹çµæ•åº¦ï¼‰
      l1_ratio: 0.15         # ğŸ”§ 0.10 -> 0.15ï¼ˆè®©å®ƒæ›´åƒ"ç¨€ç–çº¿æ€§ç»„åˆ"ï¼Œæ›´é€‚åˆæ¨ªæˆªé¢ï¼‰
      max_iter: 10000        # ğŸ”§ 5000 -> 10000ï¼ˆæ”¶æ•›æ›´ç¨³ï¼‰
      fit_intercept: true
      selection: "random"    # æ›´ç¨³ï¼ˆå¦‚æœä½ ç”¨ sklearn ElasticNetï¼‰
      random_state: 42
    
    xgboost:
      enable: true
      n_estimators: 800      # ğŸ”§ 500 -> 800ï¼ˆæ›´å¤šæ ‘ï¼Œé…åˆå°å­¦ä¹ ç‡ï¼‰
      max_depth: 5           # ğŸ”§ 4 -> 5ï¼ˆç¨å¾®æ›´æ·±ï¼‰
      learning_rate: 0.02     # ğŸ”§ 0.03 -> 0.02ï¼ˆæ›´ç¨³ï¼‰
      min_child_weight: 30   # ğŸ”§ 100 -> 30ï¼ˆä¸å†æç«¯ä¿å®ˆï¼‰
      subsample: 0.7
      colsample_bytree: 0.7
      reg_lambda: 10.0       # ğŸ”§ 5.0 -> 10.0ï¼ˆL2æ›´å¼ºï¼Œæ¢å–æ›´ç¨³ï¼‰
      reg_alpha: 0.0
      gamma: 0.0             # ğŸ”§ æ–°å¢ï¼šæœ€å°æŸå¤±å‡å°‘é˜ˆå€¼
      random_state: 42
      verbosity: 0
    
    catboost:
      enable: true
      iterations: 3000       # ğŸ”§ 1200 -> 3000ï¼ˆæ›´å¤šè¿­ä»£ï¼Œé…åˆå°å­¦ä¹ ç‡ï¼‰
      depth: 6              # ğŸ”§ 5 -> 6ï¼ˆç¨å¾®æ›´æ·±ï¼‰
      learning_rate: 0.02
      l2_leaf_reg: 20       # ğŸ”§ 10 -> 20ï¼ˆæ›´ç¨³ï¼‰
      min_data_in_leaf: 500 # ğŸ”§ 200 -> 500ï¼ˆæ›´æŠ—å™ªï¼‰
      subsample: 0.7
      loss_function: "RMSE"
      random_state: 42
      verbose: false
      allow_writing_files: false
      thread_count: -1
      od_type: "Iter"
      od_wait: 120          # ğŸ”§ 80 -> 120ï¼ˆæ›´ä¿å®ˆæ—©åœï¼‰
    
    lightgbm_ranker:
      enable: true
      objective: "regression"
      boosting_type: "gbdt"
      n_estimators: 900
      num_leaves: 63
      max_depth: -1
      learning_rate: 0.045
      feature_fraction: 0.8
      bagging_fraction: 0.8
      bagging_freq: 5
      data_sample_strategy: "bagging"
      min_sum_hessian_in_leaf: 0.01
      min_gain_to_split: 0.01
      lambda_l1: 0.1
      lambda_l2: 15.0
      max_bin: 127
      verbose: -1
      random_state: 42
      n_jobs: -1
      fit_params:
        early_stopping_rounds: 150
        eval_metric: "l2"

    lambdarank:
      enable: true
      objective: "lambdarank"
      metric: "ndcg"
      ndcg_eval_at: [10]              # ğŸ”§ èšç„¦Top10
      num_boost_round: 1200           # ğŸ”§ 700 -> 1200ï¼ˆæ›´å¤šè½®æ¬¡ï¼‰
      learning_rate: 0.01              # ğŸ”§ 0.02 -> 0.01ï¼ˆæ›´ç¨³ï¼‰
      num_leaves: 31                   # ğŸ”§ 63 -> 31ï¼ˆæ›´ä¿å®ˆï¼‰
      max_depth: 5                     # ğŸ”§ 6 -> 5ï¼ˆæ›´æµ…ï¼‰
      min_data_in_leaf: 800            # ğŸ”§ 650 -> 800ï¼ˆæ›´ç¨³ï¼‰
      lambda_l1: 0.0
      lambda_l2: 30.0                  # ğŸ”§ 22.0 -> 30.0ï¼ˆæ›´å¼ºæ­£åˆ™åŒ–ï¼‰
      feature_fraction: 0.9            # ğŸ”§ 0.85 -> 0.9ï¼ˆç‰¹å¾å°‘å°±åˆ«dropå¤ªç‹ ï¼‰
      bagging_fraction: 0.75           # ğŸ”§ 0.8 -> 0.75
      bagging_freq: 3                  # ğŸ”§ 5 -> 3
      lambdarank_truncation_level: 80  # ğŸ”§ 100 -> 80
      sigmoid: 1.1                     # ğŸ”§ 1.05 -> 1.1
      n_quantiles: 32                  # ğŸ”§ 64 -> 32
      label_gain_power: 2.1            # ğŸ”§ 2.0 -> 2.1
      fit_params:
        early_stopping_rounds: 100     # ğŸ”§ 70 -> 100ï¼ˆæ›´ä¿å®ˆæ—©åœï¼‰

  # äºŒå±‚ Meta Ranker Stacker (LightGBM Ranker for meta-learning)
  # Replaces RidgeStacker with ranking-focused optimization
  meta_ranker:
    enable: true
    objective: "lambdarank"
    metric: "ndcg"
    ndcg_eval_at: [5, 15]         # ğŸ”§ èšç„¦æ›´æ ¸å¿ƒçš„å¤´éƒ¨

    # === å­¦ä¹ ç‡ç­–ç•¥ï¼šæ…¢è·‘å¤šè·‘ ===
    learning_rate: 0.005          # ğŸ”§ å¤§å¹…é™ä½ï¼Œæ›´ç²¾ç»†çš„æ¢¯åº¦ä¸‹é™
    num_boost_round: 2000         # ğŸ”§ é…å¥—å¤§å¹…å¢åŠ è½®æ•°
    fit_params:
      early_stopping_rounds: 100  # ğŸ”§ 40 -> 100

    # === æ ‘ç»“æ„ï¼šæç®€ä¸»ä¹‰é˜²æ­¢è¿‡æ‹Ÿåˆ ===
    num_leaves: 15                # ğŸ”§ 31 -> 15ï¼ˆé™ä½å¤æ‚åº¦ï¼‰
    max_depth: 3                  # ğŸ”§ 4 -> 3
    min_data_in_leaf: 500         # ğŸ”§ 200 -> 500ï¼ˆæé«˜å¶å­èŠ‚ç‚¹é—¨æ§›ï¼‰

    # === å…³é”® LambdaRank å‚æ•° ===
    lambdarank_truncation_level: 60  # ğŸ”§ 1200 -> 60ï¼ˆâ˜…é‡ç‚¹ï¼šåªä¼˜åŒ– Top 60ï¼‰
    label_gain_power: 2.3            # ğŸ”§ 1.7 -> 2.3ï¼ˆâ˜…é‡ç‚¹ï¼šé‡èµå¤´éƒ¨å‡†ç¡®åº¦ï¼‰
    sigmoid: 1.2

    # === æ­£åˆ™åŒ–ä¸éšæœºæ€§ ===
    lambda_l1: 2.0                # ğŸ”§ 0.0 -> 2.0ï¼ˆæ–°å¢L1æ­£åˆ™åŒ–ï¼‰
    lambda_l2: 20.0               # ğŸ”§ 15.0 -> 20.0ï¼ˆå¢å¼ºL2æ­£åˆ™åŒ–ï¼‰
    feature_fraction: 0.7         # ğŸ”§ 1.0 -> 0.7
    bagging_fraction: 0.6         # ğŸ”§ 0.8 -> 0.6
    bagging_freq: 1

    n_quantiles: 64
    verbose: -1
    random_state: 42

    # === ç‰¹å¾ ===
    # å»ºè®®æ‰©å…… base_colsï¼Œè‡³å°‘åŠ å…¥ 'pred_std' (æ¨¡å‹é—´åˆ†æ­§)
    base_cols: ["pred_catboost", "pred_xgb", "pred_lambdarank", "pred_elastic"]
  
  # BMAæƒé‡æ–¹æ³•
  bma_weighting:
    method: "ic_based"                    # IC-based weighting ONLY
    min_ic_threshold: 0.001               # Minimum IC for inclusion
    normalize_weights: true               # Normalize weights to sum=1
  
  # === ENHANCED TRAINING PARAMETERS (FROM proper_training_config) ===
  enable_hyperparameter_tuning: true     # ENHANCED: Enable hyperparameter tuning
  n_jobs: -1                             # ENHANCED: Use all CPU cores
  feature_selection_method: "rolling_ic" # ENHANCED: Rolling IC method
  min_ic_threshold: 0.02                 # ENHANCED: Minimum IC threshold

  # å…ƒé›†æˆï¼ˆEWAå…ˆéªŒÃ—è¯æ®ï¼‰é…ç½®
  meta_ensemble:
    method: "ewa_with_prior"            # EWA with monthly NNLS(Ridge) prior
    lookback_days: 120                   # æœˆåº¦å…ˆéªŒå›çœ‹çª—ï¼ˆ~120äº¤æ˜“æ—¥ï¼‰
    rebalance: "M"                      # æœˆåº¦é‡ä¼°å…ˆéªŒ
    ridge_lambda: 0.01                  # å…ˆéªŒRidge L2å¼ºåº¦ï¼ˆÎ»ï¼‰
    non_negative: true                  # å…ˆéªŒéè´Ÿçº¦æŸ
    normalize: true                     # å…ˆéªŒæƒé‡å½’ä¸€
    eta: 0.8                            # EWAæ¸©åº¦ï¼ˆæŒ‡æ•°æ”¾å¤§ç³»æ•°ï¼‰
    cap: 0.9                            # å•æ¨¡å‹æƒé‡ä¸Šé™
    alpha: 0.9                          # EMAå¹³æ»‘ç³»æ•°
    ic_metric: "IC"                    # "IC" æˆ– "ICIR"
    ic_window_days: 120                 # IC/ICIRæ»šåŠ¨çª—å£ï¼ˆä¸¥æ ¼æ»åHï¼‰
    lag_days: 1                         # ä¸ç›®æ ‡T+1å¯¹é½çš„æ»åï¼ˆH=T-1 for T+1 targets - optimal info retentionï¼‰
    negative_ic_policy: "clip0"        # è´ŸICå¤„ç†ï¼šclip0 | flip | ignore
    logging:
      track_daily_weights: true         # è®°å½•æ—¥åº¦æƒé‡åˆ†å¸ƒ
      track_ic_curve: true              # è®°å½•IC/ICIRæ›²çº¿
      max_weight_hhi: true              # è®°å½•HHIé›†ä¸­åº¦
    tuning:
      eta_grid: [0.5, 0.8, 1.0, 1.2]    # çº¿ä¸Šæ ˆå¤–è°ƒå‚èŒƒå›´
      ic_metric: "ICIR"                 # é»˜è®¤é‡‡ç”¨ICIRï¼ˆå‡å€¼/æ³¢åŠ¨ï¼‰
      strict_temporal_safety: true      # ä¸¥æ ¼æ—¶é—´å®‰å…¨ï¼šä¸æ»¡è¶³ç›´æ¥æŠ¥é”™

# ==========================================
# æ¨¡å‹è¯„ä¼°é…ç½®
# ==========================================
evaluation:
  # ICè®¡ç®—é…ç½®
  ic_calculation:
    use_rank_ic: true
    temporal_aggregation: "ewm"
    decay_halflife: 30
    min_samples: 5
    
  # ç”Ÿäº§é—¨ç¦
  production_gate:
    min_rank_ic: 0.02
    min_t_stat: 2.0
    min_months: 12
    max_qlike: 0.12

# ==========================================
# éªŒè¯é˜ˆå€¼é…ç½® (VALIDATION THRESHOLDS)
# ==========================================
validation_thresholds:
  # ç”Ÿäº§å°±ç»ªé˜ˆå€¼
  production_ready_threshold: 0.8
  min_rank_ic: 0.01
  min_t_stat: 1.0
  min_stability_ratio: 0.5
  min_calibration_r2: 0.6
  max_correlation_median: 0.7

  # ç›®æ ‡å®Œæ•´æ€§éªŒè¯æ–°å‚æ•° (TARGET INTEGRITY VALIDATION)
  enable_strict_target_validation: true    # å¯ç”¨ä¸¥æ ¼ç›®æ ‡éªŒè¯ (è®¾ä¸ºfalseå¯ç”¨å®½æ¾æ¨¡å¼)
  min_target_correlation: 0.85            # åå¥½æœ€å°ç›¸å…³æ€§(ä¸é‡æ„ç›®æ ‡æ¯”è¾ƒ)
  critical_target_correlation: 0.6        # ä¸¥é‡å¤±è´¥é˜ˆå€¼(ä½äºæ­¤å€¼åœæ­¢å¤„ç†)
  min_target_overlap: 100                 # åå¥½æœ€å°é‡å æ ·æœ¬æ•°
  critical_target_overlap: 50             # ä¸¥é‡å¤±è´¥çš„é‡å é˜ˆå€¼
    
  # OOFé…ç½®
  oof:
    enable: true
    min_coverage: 0.7
    suspicious_threshold: 0.001

# ==========================================
# ä¸“ä¸šå› å­åº“é…ç½®
# ==========================================
professional_factors:
  enable: true
  decay_halflife: 30
  enable_decay: true
  
  # å› å­ç±»åˆ«
  categories:
    - technical
    - fundamental
    - sentiment
    - microstructure
    - alternative

# ==========================================
# è‡ªé€‚åº”æƒé‡é…ç½® (FROM adaptive_weights_config.yaml)
# ==========================================
adaptive_weights:
  # æƒé‡å­¦ä¹ é…ç½®
  weight_learning:
    enabled: true                        # å¯ç”¨æƒé‡å­¦ä¹ 
    lookback_days: 252                   # å†å²æ•°æ®å›çœ‹æœŸï¼ˆå¤©ï¼‰
    min_confidence: 0.6                  # æœ€å°ç½®ä¿¡åº¦é˜ˆå€¼
    max_weight: 0.4                      # å•å› å­æœ€å¤§æƒé‡
    min_weight: 0.05                     # å•å› å­æœ€å°æƒé‡
    rebalance_frequency: 21              # æƒé‡æ›´æ–°é¢‘ç‡ï¼ˆå¤©ï¼‰
  
  # å›é€€æƒé‡é…ç½®
  fallback_weights:
    momentum: 0.35                       # åŠ¨é‡ä¿¡å·å›é€€æƒé‡
    mean_reversion: 0.35                 # å‡å€¼å›å½’ä¿¡å·å›é€€æƒé‡
    quality: 0.30                        # è´¨é‡ä¿¡å·å›é€€æƒé‡
  
  # BMAæ¨¡å‹æƒé‡é…ç½®
  bma_weights:
    # ICé˜ˆå€¼é…ç½®
    ic_thresholds:
      strong: 0.1                        # å¼ºä¿¡å·é˜ˆå€¼
      weak: 0.05                         # å¼±ä¿¡å·é˜ˆå€¼
      noise: 0.02                        # å™ªéŸ³é˜ˆå€¼
    
    # æƒé‡æ˜ å°„
    weight_mapping:
      strong: 0.4                        # å¼ºä¿¡å·æƒé‡
      weak: 0.2                          # å¼±ä¿¡å·æƒé‡
      noise: 0.0                         # å™ªéŸ³æƒé‡
    
    # åŸºç¡€æ¨¡å‹æƒé‡
    base_models:
      ridge: 0.25
      xgboost: 0.3
      catboost: 0.2
      lightgbm_ranker: 0.25

# ==========================================
# é›†æˆç³»ç»Ÿé…ç½®
# ==========================================
ensemble:
  # BMAæƒé‡è®¡ç®—
  bma_weights:
    method: "ic_weighted"
    lookbook_window: 60
    min_ic_threshold: 0.01
    
  # åŠ¨æ€æƒé‡
  dynamic_weighting:
    enable: true
    update_frequency: 5
    weight_bounds: [0.0, 0.5]

# ==========================================
# å¼‚å¸¸å¤„ç†é…ç½® - NO FALLBACKS POLICY
# ==========================================
error_handling:
  enable_retry: false                   # NO RETRIES - Fail fast
  max_retries: 0                        # NO RETRIES
  enable_fallback: false                # NO FALLBACKS EVER
  log_errors: true                      # Log all errors
  raise_on_critical: true               # Always raise critical errors
  fail_fast: true                       # Fail immediately on errors
  no_exception_masking: true            # Never mask exceptions

# ==========================================
# æ€§èƒ½ä¼˜åŒ–é…ç½®
# ==========================================
optimization:
  # å†…å­˜ä¼˜åŒ–
  enable_memory_optimization: true
  max_memory_gb: 4
  gc_frequency: 100
  
  # å¹¶è¡Œå¤„ç†
  enable_parallel: true
  n_jobs: -1
  backend: "threading"
  
  # ç¼“å­˜é…ç½®
  enable_cache: true
  cache_size_mb: 500
  cache_ttl_seconds: 3600

# ==========================================
# æ—¥å¿—é…ç½®
# ==========================================
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  file: "bma_ultra_enhanced.log"
  max_size_mb: 100
  backup_count: 5
  
  # å‡å°‘æ—¥å¿—è¾“å‡º
  suppress_modules:
    - "matplotlib"
    - "sklearn"
    - "urllib3"

# ==========================================
# æ¨¡å—å¯ç”¨é˜ˆå€¼
# ==========================================
module_thresholds:
  robust_feature_min_samples: 300
  isotonic_min_samples: 200
  stacking_min_oof_coverage: 0.3
  stacking_min_models: 2
  regime_min_samples: 500
  ridge_min_samples: 1000

# ==========================================
# ALPHAå› å­é…ç½® (FROM alphas_config.yaml)
# ==========================================
alphas:
  # æŠ€æœ¯æŒ‡æ ‡å› å­
  - name: "momentum_5d"
    function: "momentum"
    period: 5
    decay: 15
    enabled: true
  - name: "momentum_20d" 
    function: "momentum"
    period: 20
    decay: 20
    enabled: true
  - name: "mean_reversion_10d"
    function: "mean_reversion"
    period: 10
    decay: 20
    enabled: true
  - name: "volatility_5d"
    function: "volatility"
    period: 5
    decay: 8
    enabled: true
  - name: "volume_ratio"
    function: "volume_ratio"
    period: 20
    decay: 10
    enabled: true
  - name: "rsi_14d"
    function: "rsi"
    period: 14
    decay: 14
    enabled: true
    
  # åŸºæœ¬é¢å› å­
  - name: "earnings_yield"
    function: "earnings_yield"
    period: 252
    decay: 60
    enabled: true
  - name: "book_to_market"
    function: "pb_ratio"
    period: 252
    decay: 60
    enabled: true
  - name: "roe_factor"
    function: "roe_neutralized"
    period: 252
    decay: 60
    enabled: true
    
  # è´¨é‡å› å­
  - name: "piotroski_score"
    function: "piotroski_score"
    period: 252
    decay: 90
    enabled: true
  - name: "altman_score"
    function: "altman_score" 
    period: 252
    decay: 90
    enabled: true
    
  # é£é™©å› å­
  - name: "low_beta"
    function: "low_beta"
    period: 252
    decay: 60
    enabled: true
  - name: "idiosyncratic_vol"
    function: "idiosyncratic_vol"
    period: 60
    decay: 20
    enabled: true

# Alphaå¤„ç†é…ç½®
alpha_processing:
  winsorize_quantiles: [0.01, 0.99]
  standardization: "cross_sectional"
  neutralization:
    by_industry: false
    by_market_cap: false

# ==========================================
# å­˜å‚¨é…ç½® (FROM adaptive_weights_config.yaml)
# ==========================================
storage:
  cache_dir: "cache/factor_weights"
  max_history_records: 20
  cleanup_frequency_days: 3

# ==========================================
# ç›‘æ§é…ç½® (FROM adaptive_weights_config.yaml)
# ==========================================
monitoring:
  log_weight_changes: false
  performance_tracking: false

# ==========================================
# é»˜è®¤è‚¡ç¥¨æ± 
# ==========================================
default_tickers:
  - AAPL
  - MSFT
  - AMZN
  - NVDA
  - GOOGL
  - TSLA
  - META
  - BRK-B
  - UNH
  - JNJ
  - JPM
  - V
  - MA
  - BAC
  - WMT
  - PG
  - HD
  - DIS
  - NFLX
  - ADBE

# ==========================================
# EOD äº¤æ˜“é…ç½® (åˆå¹¶è‡ª autotrader/config/eod_trading_config.yaml)
# ==========================================
# æ”¶ç›˜åä¿¡å·ç”Ÿæˆ + æ¬¡æ—¥å¼€ç›˜ä¸‹å•æ¨¡å¼é…ç½®
eod_trading:
  # ç­–ç•¥é…ç½®
  strategy:
    double_trend:
      eod_mode: true                    # åªåœ¨æ”¶ç›˜åè·‘ä¿¡å·
      run_after_close_min: 20           # æ”¶ç›˜åç­‰20åˆ†é’Ÿè§¦å‘ï¼Œé¿å…15åˆ†é’Ÿå»¶è¿Ÿ
      
    execution:
      open_order_type: "LOO"            # é¦–é€‰å¼€ç›˜é™ä»·å•ï¼›ä¹Ÿæ”¯æŒ "MOO"
      avoid_open_auction: false         # å¦‚éœ€é¿å¼€å¼€ç›˜ç«ä»·é˜¶æ®µï¼Œæ”¹æˆ true
      limit_band_by_atr_mult: 0.5       # å¼€ä»“ä»·å¸¦ = 0.5Ã—ATR
      limit_band_floor_pct: 0.003       # ä»·å¸¦åœ°æ¿=0.30%
      limit_band_cap_pct: 0.015         # ä»·å¸¦ä¸Šé™=1.5%
      cancel_if_not_filled_minutes: 30  # å¼€ç›˜å30åˆ†é’Ÿæœªæˆæ’¤å•

  # é£é™©ç®¡ç†é…ç½®
  risk_management:
    default_stop_pct: 0.01             # åˆå§‹æ­¢æŸ1%
    
    atr_trailing:
      enabled: true                     # å¯ç”¨ATRç§»åŠ¨æ­¢æŸ
      period: 14                        # ATRè®¡ç®—æœŸé—´
      multiplier: 2.0                   # ATRå€æ•°
      activate_after_R: 1.0             # æµ®ç›ˆ>=1Ræ—¶æ¿€æ´»
      eod_update_only: true             # åªåœ¨EODæ›´æ–°ç§»åŠ¨æ­¢æŸ

  # ä»“ä½ç®¡ç†é…ç½®
  sizing:
    per_trade_risk_pct: 0.005          # å»¶è¿Ÿç¯å¢ƒå»ºè®®å•ç¬”é£é™©0.5%
    max_position_pct_of_equity: 0.10   # å•ä»“ä½æœ€å¤§10%èµ„é‡‘
    base_dollar_amount: 10000          # åŸºç¡€ä¸‹å•é‡‘é¢

  # äº¤æ˜“æ—¶é—´é…ç½®
  timing:
    market_open_time: "09:30"          # ç¾è‚¡å¼€ç›˜æ—¶é—´
    market_close_time: "16:00"         # ç¾è‚¡æ”¶ç›˜æ—¶é—´
    eod_signal_delay_min: 20           # æ”¶ç›˜åå»¶è¿Ÿæ—¶é—´
    
  # æ•°æ®æºé…ç½®
  data_sources:
    primary: "polygon"                  # ä¸»è¦æ•°æ®æº
    backup: "yahoo"                     # å¤‡ç”¨æ•°æ®æº
    daily_bars_lookback: 200           # æ—¥çº¿æ•°æ®å›æº¯å¤©æ•°
    
  # è®¢å•æ‰§è¡Œé…ç½®
  order_execution:
    default_exchange: "SMART"          # é»˜è®¤äº¤æ˜“æ‰€
    currency: "USD"                    # äº¤æ˜“è´§å¸
    enable_risk_validation: true       # å¯ç”¨é£æ§æ ¡éªŒ
    enable_audit_logging: true         # å¯ç”¨å®¡è®¡æ—¥å¿—
    
  # ç›‘æ§é…ç½®
  monitoring:
    enable_alerts: true
    alert_channels: ["email", "log"]
    track_execution_metrics: true

# ==========================================
# PCA é…ç½® (åˆå¹¶è‡ª unified_pca_config.py)
# ==========================================
pca:
  # æ ¸å¿ƒè®¾ç½®
  enabled: true
  method: "separated"  # unified, separated, time_safe, disabled
  
  # æ–¹å·®é˜ˆå€¼
  variance_threshold: 0.95  # æ ‡å‡†åŒ–ï¼šå§‹ç»ˆä¸º 0.95
  
  # ç»„ä»¶æ•°é‡
  traditional_components: 10  # ä¼ ç»Ÿç‰¹å¾å›ºå®šä½¿ç”¨ 10 ä¸ªç»„ä»¶
  alpha_components: 5         # Alpha ç‰¹å¾å›ºå®šä½¿ç”¨ 5 ä¸ªç»„ä»¶
  
  # å®‰å…¨çº¦æŸ
  min_components: 1
  max_components_ratio: 0.8  # æœ€å¤§ç»„ä»¶æ•° = 80% çš„è¾“å…¥ç‰¹å¾æ•°
  
  # Time-Safe PCA è®¾ç½®
  time_safe:
    min_history_days: 60
    refit_frequency: 21
    rolling_window_mode: true
  
  # ç”Ÿäº§é…ç½®
  production:
    enable_caching: true
    cache_duration_hours: 24
    validation_threshold: 0.02